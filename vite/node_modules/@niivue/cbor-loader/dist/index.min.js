var ar=Object.create;var Wi=Object.defineProperty;var or=Object.getOwnPropertyDescriptor;var lr=Object.getOwnPropertyNames;var fr=Object.getPrototypeOf,hr=Object.prototype.hasOwnProperty;var Kt=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var ur=(e,t,i,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of lr(t))!hr.call(e,r)&&r!==i&&Wi(e,r,{get:()=>t[r],enumerable:!(n=or(t,r))||n.enumerable});return e};var cr=(e,t,i)=>(i=e!=null?ar(fr(e)):{},ur(t||!e||!e.__esModule?Wi(i,"default",{value:e,enumerable:!0}):i,e));var tr=Kt(D=>{"use strict";var xn={},In={};In.default=function(e,t,i,n,r){var s=new Worker(xn[t]||(xn[t]=URL.createObjectURL(new Blob([e+';addEventListener("error",function(e){e=e.error;postMessage({$e$:[e.message,e.code,e.stack]})})'],{type:"text/javascript"}))));return s.onmessage=function(a){var o=a.data,l=o.$e$;if(l){var f=new Error(l[0]);f.code=l[1],f.stack=l[2],r(f,null)}else r(null,o)},s.postMessage(i,n),s};var G=Uint8Array,ut=Uint16Array,Ie=Int32Array,te=new G([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ee=new G([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),xe=new G([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),En=function(e,t){for(var i=new ut(31),n=0;n<31;++n)i[n]=t+=1<<e[n-1];for(var r=new Ie(i[30]),n=1;n<30;++n)for(var s=i[n];s<i[n+1];++s)r[s]=s-i[n]<<5|n;return{b:i,r}},An=En(te,2),Ni=An.b,je=An.r;Ni[28]=258,je[258]=28;var wn=En(ee,0),_n=wn.b,_i=wn.r,me=new ut(32768);for(J=0;J<32768;++J)Nt=(J&43690)>>1|(J&21845)<<1,Nt=(Nt&52428)>>2|(Nt&13107)<<2,Nt=(Nt&61680)>>4|(Nt&3855)<<4,me[J]=((Nt&65280)>>8|(Nt&255)<<8)>>1;var Nt,J,vt=function(e,t,i){for(var n=e.length,r=0,s=new ut(t);r<n;++r)e[r]&&++s[e[r]-1];var a=new ut(t);for(r=1;r<t;++r)a[r]=a[r-1]+s[r-1]<<1;var o;if(i){o=new ut(1<<t);var l=15-t;for(r=0;r<n;++r)if(e[r])for(var f=r<<4|e[r],d=t-e[r],h=a[e[r]-1]++<<d,v=h|(1<<d)-1;h<=v;++h)o[me[h]>>l]=f}else for(o=new ut(n),r=0;r<n;++r)e[r]&&(o[r]=me[a[e[r]-1]++]>>15-e[r]);return o},Ot=new G(288);for(J=0;J<144;++J)Ot[J]=8;var J;for(J=144;J<256;++J)Ot[J]=9;var J;for(J=256;J<280;++J)Ot[J]=7;var J;for(J=280;J<288;++J)Ot[J]=8;var J,Wt=new G(32);for(J=0;J<32;++J)Wt[J]=5;var J,Sn=vt(Ot,9,0),Un=vt(Ot,9,1),bn=vt(Wt,5,0),Tn=vt(Wt,5,1),Le=function(e){for(var t=e[0],i=1;i<e.length;++i)e[i]>t&&(t=e[i]);return t},mt=function(e,t,i){var n=t/8|0;return(e[n]|e[n+1]<<8)>>(t&7)&i},Ve=function(e,t){var i=t/8|0;return(e[i]|e[i+1]<<8|e[i+2]<<16)>>(t&7)},ie=function(e){return(e+7)/8|0},It=function(e,t,i){return(t==null||t<0)&&(t=0),(i==null||i>e.length)&&(i=e.length),new G(e.subarray(t,i))};D.FlateErrorCode={UnexpectedEOF:0,InvalidBlockType:1,InvalidLengthLiteral:2,InvalidDistance:3,StreamFinished:4,NoStreamHandler:5,InvalidHeader:6,NoCallback:7,InvalidUTF8:8,ExtraFieldTooLong:9,InvalidDate:10,FilenameTooLong:11,StreamFinishing:12,InvalidZipData:13,UnknownCompressionMethod:14};var Mn=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],F=function(e,t,i){var n=new Error(t||Mn[e]);if(n.code=e,Error.captureStackTrace&&Error.captureStackTrace(n,F),!i)throw n;return n},Ee=function(e,t,i,n){var r=e.length,s=n?n.length:0;if(!r||t.f&&!t.l)return i||new G(0);var a=!i,o=a||t.i!=2,l=t.i;a&&(i=new G(r*3));var f=function(fe){var he=i.length;if(fe>he){var Zt=new G(Math.max(he*2,fe));Zt.set(i),i=Zt}},d=t.f||0,h=t.p||0,v=t.b||0,S=t.l,A=t.d,U=t.m,_=t.n,b=r*8;do{if(!S){d=mt(e,h,1);var B=mt(e,h+1,3);if(h+=3,B)if(B==1)S=Un,A=Tn,U=9,_=5;else if(B==2){var K=mt(e,h,31)+257,q=mt(e,h+10,15)+4,O=K+mt(e,h+5,31)+1;h+=14;for(var T=new G(O),k=new G(19),j=0;j<q;++j)k[xe[j]]=mt(e,h+j*3,7);h+=q*3;for(var V=Le(k),Y=(1<<V)-1,c=vt(k,V,1),j=0;j<O;){var I=c[mt(e,h,Y)];h+=I&15;var N=I>>4;if(N<16)T[j++]=N;else{var y=0,g=0;for(N==16?(g=3+mt(e,h,3),h+=2,y=T[j-1]):N==17?(g=3+mt(e,h,7),h+=3):N==18&&(g=11+mt(e,h,127),h+=7);g--;)T[j++]=y}}var m=T.subarray(0,K),w=T.subarray(K);U=Le(m),_=Le(w),S=vt(m,U,1),A=vt(w,_,1)}else F(1);else{var N=ie(h)+4,E=e[N-4]|e[N-3]<<8,X=N+E;if(X>r){l&&F(0);break}o&&f(v+E),i.set(e.subarray(N,X),v),t.b=v+=E,t.p=h=X*8,t.f=d;continue}if(h>b){l&&F(0);break}}o&&f(v+131072);for(var z=(1<<U)-1,C=(1<<_)-1,P=h;;P=h){var y=S[Ve(e,h)&z],R=y>>4;if(h+=y&15,h>b){l&&F(0);break}if(y||F(2),R<256)i[v++]=R;else if(R==256){P=h,S=null;break}else{var lt=R-254;if(R>264){var j=R-257,et=te[j];lt=mt(e,h,(1<<et)-1)+Ni[j],h+=et}var St=A[Ve(e,h)&C],Gt=St>>4;St||F(3),h+=St&15;var w=_n[Gt];if(Gt>3){var et=ee[Gt];w+=Ve(e,h)&(1<<et)-1,h+=et}if(h>b){l&&F(0);break}o&&f(v+131072);var jt=v+lt;if(v<w){var Se=s-w,Ue=Math.min(w,jt);for(Se+v<0&&F(3);v<Ue;++v)i[v]=n[Se+v]}for(;v<jt;++v)i[v]=i[v-w]}}t.l=S,t.p=P,t.b=v,t.f=d,S&&(d=1,t.m=U,t.d=A,t.n=_)}while(!d);return v!=i.length&&a?It(i,0,v):i.subarray(0,v)},Tt=function(e,t,i){i<<=t&7;var n=t/8|0;e[n]|=i,e[n+1]|=i>>8},$t=function(e,t,i){i<<=t&7;var n=t/8|0;e[n]|=i,e[n+1]|=i>>8,e[n+2]|=i>>16},Ge=function(e,t){for(var i=[],n=0;n<e.length;++n)e[n]&&i.push({s:n,f:e[n]});var r=i.length,s=i.slice();if(!r)return{t:Bt,l:0};if(r==1){var a=new G(i[0].s+1);return a[i[0].s]=1,{t:a,l:1}}i.sort(function(X,K){return X.f-K.f}),i.push({s:-1,f:25001});var o=i[0],l=i[1],f=0,d=1,h=2;for(i[0]={s:-1,f:o.f+l.f,l:o,r:l};d!=r-1;)o=i[i[f].f<i[h].f?f++:h++],l=i[f!=d&&i[f].f<i[h].f?f++:h++],i[d++]={s:-1,f:o.f+l.f,l:o,r:l};for(var v=s[0].s,n=1;n<r;++n)s[n].s>v&&(v=s[n].s);var S=new ut(v+1),A=Ze(i[d-1],S,0);if(A>t){var n=0,U=0,_=A-t,b=1<<_;for(s.sort(function(K,q){return S[q.s]-S[K.s]||K.f-q.f});n<r;++n){var B=s[n].s;if(S[B]>t)U+=b-(1<<A-S[B]),S[B]=t;else break}for(U>>=_;U>0;){var N=s[n].s;S[N]<t?U-=1<<t-S[N]++-1:++n}for(;n>=0&&U;--n){var E=s[n].s;S[E]==t&&(--S[E],++U)}A=t}return{t:new G(S),l:A}},Ze=function(e,t,i){return e.s==-1?Math.max(Ze(e.l,t,i+1),Ze(e.r,t,i+1)):t[e.s]=i},Si=function(e){for(var t=e.length;t&&!e[--t];);for(var i=new ut(++t),n=0,r=e[0],s=1,a=function(l){i[n++]=l},o=1;o<=t;++o)if(e[o]==r&&o!=t)++s;else{if(!r&&s>2){for(;s>138;s-=138)a(32754);s>2&&(a(s>10?s-11<<5|28690:s-3<<5|12305),s=0)}else if(s>3){for(a(r),--s;s>6;s-=6)a(8304);s>2&&(a(s-3<<5|8208),s=0)}for(;s--;)a(r);s=1,r=e[o]}return{c:i.subarray(0,n),n:t}},Qt=function(e,t){for(var i=0,n=0;n<t.length;++n)i+=e[n]*t[n];return i},Oi=function(e,t,i){var n=i.length,r=ie(t+2);e[r]=n&255,e[r+1]=n>>8,e[r+2]=e[r]^255,e[r+3]=e[r+1]^255;for(var s=0;s<n;++s)e[r+s+4]=i[s];return(r+4+n)*8},Ui=function(e,t,i,n,r,s,a,o,l,f,d){Tt(t,d++,i),++r[256];for(var h=Ge(r,15),v=h.t,S=h.l,A=Ge(s,15),U=A.t,_=A.l,b=Si(v),B=b.c,N=b.n,E=Si(U),X=E.c,K=E.n,q=new ut(19),O=0;O<B.length;++O)++q[B[O]&31];for(var O=0;O<X.length;++O)++q[X[O]&31];for(var T=Ge(q,7),k=T.t,j=T.l,V=19;V>4&&!k[xe[V-1]];--V);var Y=f+5<<3,c=Qt(r,Ot)+Qt(s,Wt)+a,I=Qt(r,v)+Qt(s,U)+a+14+3*V+Qt(q,k)+2*q[16]+3*q[17]+7*q[18];if(l>=0&&Y<=c&&Y<=I)return Oi(t,d,e.subarray(l,l+f));var y,g,m,w;if(Tt(t,d,1+(I<c)),d+=2,I<c){y=vt(v,S,0),g=v,m=vt(U,_,0),w=U;var z=vt(k,j,0);Tt(t,d,N-257),Tt(t,d+5,K-1),Tt(t,d+10,V-4),d+=14;for(var O=0;O<V;++O)Tt(t,d+3*O,k[xe[O]]);d+=3*V;for(var C=[B,X],P=0;P<2;++P)for(var R=C[P],O=0;O<R.length;++O){var lt=R[O]&31;Tt(t,d,z[lt]),d+=k[lt],lt>15&&(Tt(t,d,R[O]>>5&127),d+=R[O]>>12)}}else y=Sn,g=Ot,m=bn,w=Wt;for(var O=0;O<o;++O){var et=n[O];if(et>255){var lt=et>>18&31;$t(t,d,y[lt+257]),d+=g[lt+257],lt>7&&(Tt(t,d,et>>23&31),d+=te[lt]);var St=et&31;$t(t,d,m[St]),d+=w[St],St>3&&($t(t,d,et>>5&8191),d+=ee[St])}else $t(t,d,y[et]),d+=g[et]}return $t(t,d,y[256]),d+g[256]},Fn=new Ie([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Bt=new G(0),Nn=function(e,t,i,n,r,s){var a=s.z||e.length,o=new G(n+a+5*(1+Math.ceil(a/7e3))+r),l=o.subarray(n,o.length-r),f=s.l,d=(s.r||0)&7;if(t){d&&(l[0]=s.r>>3);for(var h=Fn[t-1],v=h>>13,S=h&8191,A=(1<<i)-1,U=s.p||new ut(32768),_=s.h||new ut(A+1),b=Math.ceil(i/3),B=2*b,N=function(si){return(e[si]^e[si+1]<<b^e[si+2]<<B)&A},E=new Ie(25e3),X=new ut(288),K=new ut(32),q=0,O=0,T=s.i||0,k=0,j=s.w||0,V=0;T+2<a;++T){var Y=N(T),c=T&32767,I=_[Y];if(U[c]=I,_[Y]=c,j<=T){var y=a-T;if((q>7e3||k>24576)&&(y>423||!f)){d=Ui(e,l,0,E,X,K,O,k,V,T-V,d),k=q=O=0,V=T;for(var g=0;g<286;++g)X[g]=0;for(var g=0;g<30;++g)K[g]=0}var m=2,w=0,z=S,C=c-I&32767;if(y>2&&Y==N(T-C))for(var P=Math.min(v,y)-1,R=Math.min(32767,T),lt=Math.min(258,y);C<=R&&--z&&c!=I;){if(e[T+m]==e[T+m-C]){for(var et=0;et<lt&&e[T+et]==e[T+et-C];++et);if(et>m){if(m=et,w=C,et>P)break;for(var St=Math.min(C,et-2),Gt=0,g=0;g<St;++g){var jt=T-C+g&32767,Se=U[jt],Ue=jt-Se&32767;Ue>Gt&&(Gt=Ue,I=jt)}}}c=I,I=U[c],C+=c-I&32767}if(w){E[k++]=268435456|je[m]<<18|_i[w];var fe=je[m]&31,he=_i[w]&31;O+=te[fe]+ee[he],++X[257+fe],++K[he],j=T+m,++q}else E[k++]=e[T],++X[e[T]]}}for(T=Math.max(T,j);T<a;++T)E[k++]=e[T],++X[e[T]];d=Ui(e,l,f,E,X,K,O,k,V,T-V,d),f||(s.r=d&7|l[d/8|0]<<3,d-=7,s.h=_,s.p=U,s.i=T,s.w=j)}else{for(var T=s.w||0;T<a+f;T+=65535){var Zt=T+65535;Zt>=a&&(l[d/8|0]=f,Zt=a),d=Oi(l,d+1,e.subarray(T,Zt))}s.i=a}return It(o,0,n+ie(d)+r)},On=function(){for(var e=new Int32Array(256),t=0;t<256;++t){for(var i=t,n=9;--n;)i=(i&1&&-306674912)^i>>>1;e[t]=i}return e}(),ne=function(){var e=-1;return{p:function(t){for(var i=e,n=0;n<t.length;++n)i=On[i&255^t[n]]^i>>>8;e=i},d:function(){return~e}}},Je=function(){var e=1,t=0;return{p:function(i){for(var n=e,r=t,s=i.length|0,a=0;a!=s;){for(var o=Math.min(a+2655,s);a<o;++a)r+=n+=i[a];n=(n&65535)+15*(n>>16),r=(r&65535)+15*(r>>16)}e=n,t=r},d:function(){return e%=65521,t%=65521,(e&255)<<24|(e&65280)<<8|(t&255)<<8|t>>8}}},Lt=function(e,t,i,n,r){if(!r&&(r={l:1},t.dictionary)){var s=t.dictionary.subarray(-32768),a=new G(s.length+e.length);a.set(s),a.set(e,s.length),e=a,r.w=s.length}return Nn(e,t.level==null?6:t.level,t.mem==null?r.l?Math.ceil(Math.max(8,Math.min(13,Math.log(e.length)))*1.5):20:12+t.mem,i,n,r)},Ae=function(e,t){var i={};for(var n in e)i[n]=e[n];for(var n in t)i[n]=t[n];return i},mn=function(e,t,i){for(var n=e(),r=e.toString(),s=r.slice(r.indexOf("[")+1,r.lastIndexOf("]")).replace(/\s+/g,"").split(","),a=0;a<n.length;++a){var o=n[a],l=s[a];if(typeof o=="function"){t+=";"+l+"=";var f=o.toString();if(o.prototype)if(f.indexOf("[native code]")!=-1){var d=f.indexOf(" ",8)+1;t+=f.slice(d,f.indexOf("(",d))}else{t+=f;for(var h in o.prototype)t+=";"+l+".prototype."+h+"="+o.prototype[h].toString()}else t+=f}else i[l]=o}return t},ke=[],qr=function(e){var t=[];for(var i in e)e[i].buffer&&t.push((e[i]=new e[i].constructor(e[i])).buffer);return t},Cn=function(e,t,i,n){if(!ke[i]){for(var r="",s={},a=e.length-1,o=0;o<a;++o)r=mn(e[o],r,s);ke[i]={c:mn(e[a],r,s),e:s}}var l=Ae({},ke[i].e);return(0,In.default)(ke[i].c+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+t.toString()+"}",i,l,qr(l),n)},re=function(){return[G,ut,Ie,te,ee,xe,Ni,_n,Un,Tn,me,Mn,vt,Le,mt,Ve,ie,It,F,Ee,le,Pt,Ci]},se=function(){return[G,ut,Ie,te,ee,xe,je,_i,Sn,Ot,bn,Wt,me,Fn,Bt,vt,Tt,$t,Ge,Ze,Si,Qt,Oi,Ui,ie,It,Nn,Lt,we,Pt]},Bn=function(){return[Bi,Di,W,ne,On]},zn=function(){return[zi,Rn]},Dn=function(){return[Pi,W,Je]},Pn=function(){return[Ri]},Pt=function(e){return postMessage(e,[e.buffer])},Ci=function(e){return e&&{out:e.size&&new G(e.size),dictionary:e.dictionary}},ae=function(e,t,i,n,r,s){var a=Cn(i,n,r,function(o,l){a.terminate(),s(o,l)});return a.postMessage([e,t],t.consume?[e.buffer]:[]),function(){a.terminate()}},At=function(e){return e.ondata=function(t,i){return postMessage([t,i],[t.buffer])},function(t){t.data.length?(e.push(t.data[0],t.data[1]),postMessage([t.data[0].length])):e.flush()}},oe=function(e,t,i,n,r,s,a){var o,l=Cn(e,n,r,function(f,d){f?(l.terminate(),t.ondata.call(t,f)):Array.isArray(d)?d.length==1?(t.queuedSize-=d[0],t.ondrain&&t.ondrain(d[0])):(d[1]&&l.terminate(),t.ondata.call(t,f,d[0],d[1])):a(d)});l.postMessage(i),t.queuedSize=0,t.push=function(f,d){t.ondata||F(5),o&&t.ondata(F(4,0,1),null,!!d),t.queuedSize+=f.length,l.postMessage([f,o=d],[f.buffer])},t.terminate=function(){l.terminate()},s&&(t.flush=function(){l.postMessage([])})},ht=function(e,t){return e[t]|e[t+1]<<8},nt=function(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0},wi=function(e,t){return nt(e,t)+nt(e,t+4)*4294967296},W=function(e,t,i){for(;i;++t)e[t]=i,i>>>=8},Bi=function(e,t){var i=t.filename;if(e[0]=31,e[1]=139,e[2]=8,e[8]=t.level<2?4:t.level==9?2:0,e[9]=3,t.mtime!=0&&W(e,4,Math.floor(new Date(t.mtime||Date.now())/1e3)),i){e[3]=8;for(var n=0;n<=i.length;++n)e[n+10]=i.charCodeAt(n)}},zi=function(e){(e[0]!=31||e[1]!=139||e[2]!=8)&&F(6,"invalid gzip data");var t=e[3],i=10;t&4&&(i+=(e[10]|e[11]<<8)+2);for(var n=(t>>3&1)+(t>>4&1);n>0;n-=!e[i++]);return i+(t&2)},Rn=function(e){var t=e.length;return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0},Di=function(e){return 10+(e.filename?e.filename.length+1:0)},Pi=function(e,t){var i=t.level,n=i==0?0:i<6?1:i==9?3:2;if(e[0]=120,e[1]=n<<6|(t.dictionary&&32),e[1]|=31-(e[0]<<8|e[1])%31,t.dictionary){var r=Je();r.p(t.dictionary),W(e,2,r.d())}},Ri=function(e,t){return((e[0]&15)!=8||e[0]>>4>7||(e[0]<<8|e[1])%31)&&F(6,"invalid zlib data"),(e[1]>>5&1)==+!t&&F(6,"invalid zlib data: "+(e[1]&32?"need":"unexpected")+" dictionary"),(e[1]>>3&4)+2};function Vt(e,t){return typeof e=="function"&&(t=e,e={}),this.ondata=t,e}var Et=function(){function e(t,i){if(typeof t=="function"&&(i=t,t={}),this.ondata=i,this.o=t||{},this.s={l:0,i:32768,w:32768,z:32768},this.b=new G(98304),this.o.dictionary){var n=this.o.dictionary.subarray(-32768);this.b.set(n,32768-n.length),this.s.i=32768-n.length}}return e.prototype.p=function(t,i){this.ondata(Lt(t,this.o,0,0,this.s),i)},e.prototype.push=function(t,i){this.ondata||F(5),this.s.l&&F(4);var n=t.length+this.s.z;if(n>this.b.length){if(n>2*this.b.length-32768){var r=new G(n&-32768);r.set(this.b.subarray(0,this.s.z)),this.b=r}var s=this.b.length-this.s.z;this.b.set(t.subarray(0,s),this.s.z),this.s.z=this.b.length,this.p(this.b,!1),this.b.set(this.b.subarray(-32768)),this.b.set(t.subarray(s),32768),this.s.z=t.length-s+32768,this.s.i=32766,this.s.w=32768}else this.b.set(t,this.s.z),this.s.z+=t.length;this.s.l=i&1,(this.s.z>this.s.w+8191||i)&&(this.p(this.b,i||!1),this.s.w=this.s.i,this.s.i-=2)},e.prototype.flush=function(){this.ondata||F(5),this.s.l&&F(4),this.p(this.b,!1),this.s.w=this.s.i,this.s.i-=2},e}();D.Deflate=Et;var qn=function(){function e(t,i){oe([se,function(){return[At,Et]}],this,Vt.call(this,t,i),function(n){var r=new Et(n.data);onmessage=At(r)},6,1)}return e}();D.AsyncDeflate=qn;function kn(e,t,i){return i||(i=t,t={}),typeof i!="function"&&F(7),ae(e,t,[se],function(n){return Pt(we(n.data[0],n.data[1]))},0,i)}D.deflate=kn;function we(e,t){return Lt(e,t||{},0,0)}D.deflateSync=we;var dt=function(){function e(t,i){typeof t=="function"&&(i=t,t={}),this.ondata=i;var n=t&&t.dictionary&&t.dictionary.subarray(-32768);this.s={i:0,b:n?n.length:0},this.o=new G(32768),this.p=new G(0),n&&this.o.set(n)}return e.prototype.e=function(t){if(this.ondata||F(5),this.d&&F(4),!this.p.length)this.p=t;else if(t.length){var i=new G(this.p.length+t.length);i.set(this.p),i.set(t,this.p.length),this.p=i}},e.prototype.c=function(t){this.s.i=+(this.d=t||!1);var i=this.s.b,n=Ee(this.p,this.s,this.o);this.ondata(It(n,i,this.s.b),this.d),this.o=It(n,this.s.b-32768),this.s.b=this.o.length,this.p=It(this.p,this.s.p/8|0),this.s.p&=7},e.prototype.push=function(t,i){this.e(t),this.c(i)},e}();D.Inflate=dt;var qi=function(){function e(t,i){oe([re,function(){return[At,dt]}],this,Vt.call(this,t,i),function(n){var r=new dt(n.data);onmessage=At(r)},7,0)}return e}();D.AsyncInflate=qi;function ki(e,t,i){return i||(i=t,t={}),typeof i!="function"&&F(7),ae(e,t,[re],function(n){return Pt(le(n.data[0],Ci(n.data[1])))},1,i)}D.inflate=ki;function le(e,t){return Ee(e,{i:2},t&&t.out,t&&t.dictionary)}D.inflateSync=le;var Ke=function(){function e(t,i){this.c=ne(),this.l=0,this.v=1,Et.call(this,t,i)}return e.prototype.push=function(t,i){this.c.p(t),this.l+=t.length,Et.prototype.push.call(this,t,i)},e.prototype.p=function(t,i){var n=Lt(t,this.o,this.v&&Di(this.o),i&&8,this.s);this.v&&(Bi(n,this.o),this.v=0),i&&(W(n,n.length-8,this.c.d()),W(n,n.length-4,this.l)),this.ondata(n,i)},e.prototype.flush=function(){Et.prototype.flush.call(this)},e}();D.Gzip=Ke;D.Compress=Ke;var Ln=function(){function e(t,i){oe([se,Bn,function(){return[At,Et,Ke]}],this,Vt.call(this,t,i),function(n){var r=new Ke(n.data);onmessage=At(r)},8,1)}return e}();D.AsyncGzip=Ln;D.AsyncCompress=Ln;function Vn(e,t,i){return i||(i=t,t={}),typeof i!="function"&&F(7),ae(e,t,[se,Bn,function(){return[Ye]}],function(n){return Pt(Ye(n.data[0],n.data[1]))},2,i)}D.gzip=Vn;D.compress=Vn;function Ye(e,t){t||(t={});var i=ne(),n=e.length;i.p(e);var r=Lt(e,t,Di(t),8),s=r.length;return Bi(r,t),W(r,s-8,i.d()),W(r,s-4,n),r}D.gzipSync=Ye;D.compressSync=Ye;var Xe=function(){function e(t,i){this.v=1,this.r=0,dt.call(this,t,i)}return e.prototype.push=function(t,i){if(dt.prototype.e.call(this,t),this.r+=t.length,this.v){var n=this.p.subarray(this.v-1),r=n.length>3?zi(n):4;if(r>n.length){if(!i)return}else this.v>1&&this.onmember&&this.onmember(this.r-n.length);this.p=n.subarray(r),this.v=0}dt.prototype.c.call(this,i),this.s.f&&!this.s.l&&!i&&(this.v=ie(this.s.p)+9,this.s={i:0},this.o=new G(0),this.push(new G(0),i))},e}();D.Gunzip=Xe;var Gn=function(){function e(t,i){var n=this;oe([re,zn,function(){return[At,dt,Xe]}],this,Vt.call(this,t,i),function(r){var s=new Xe(r.data);s.onmember=function(a){return postMessage(a)},onmessage=At(s)},9,0,function(r){return n.onmember&&n.onmember(r)})}return e}();D.AsyncGunzip=Gn;function jn(e,t,i){return i||(i=t,t={}),typeof i!="function"&&F(7),ae(e,t,[re,zn,function(){return[He]}],function(n){return Pt(He(n.data[0],n.data[1]))},3,i)}D.gunzip=jn;function He(e,t){var i=zi(e);return i+8>e.length&&F(6,"invalid gzip data"),Ee(e.subarray(i,-8),{i:2},t&&t.out||new G(Rn(e)),t&&t.dictionary)}D.gunzipSync=He;var bi=function(){function e(t,i){this.c=Je(),this.v=1,Et.call(this,t,i)}return e.prototype.push=function(t,i){this.c.p(t),Et.prototype.push.call(this,t,i)},e.prototype.p=function(t,i){var n=Lt(t,this.o,this.v&&(this.o.dictionary?6:2),i&&4,this.s);this.v&&(Pi(n,this.o),this.v=0),i&&W(n,n.length-4,this.c.d()),this.ondata(n,i)},e.prototype.flush=function(){Et.prototype.flush.call(this)},e}();D.Zlib=bi;var kr=function(){function e(t,i){oe([se,Dn,function(){return[At,Et,bi]}],this,Vt.call(this,t,i),function(n){var r=new bi(n.data);onmessage=At(r)},10,1)}return e}();D.AsyncZlib=kr;function Lr(e,t,i){return i||(i=t,t={}),typeof i!="function"&&F(7),ae(e,t,[se,Dn,function(){return[Ti]}],function(n){return Pt(Ti(n.data[0],n.data[1]))},4,i)}D.zlib=Lr;function Ti(e,t){t||(t={});var i=Je();i.p(e);var n=Lt(e,t,t.dictionary?6:2,4);return Pi(n,t),W(n,n.length-4,i.d()),n}D.zlibSync=Ti;var $e=function(){function e(t,i){dt.call(this,t,i),this.v=t&&t.dictionary?2:1}return e.prototype.push=function(t,i){if(dt.prototype.e.call(this,t),this.v){if(this.p.length<6&&!i)return;this.p=this.p.subarray(Ri(this.p,this.v-1)),this.v=0}i&&(this.p.length<4&&F(6,"invalid zlib data"),this.p=this.p.subarray(0,-4)),dt.prototype.c.call(this,i)},e}();D.Unzlib=$e;var Zn=function(){function e(t,i){oe([re,Pn,function(){return[At,dt,$e]}],this,Vt.call(this,t,i),function(n){var r=new $e(n.data);onmessage=At(r)},11,0)}return e}();D.AsyncUnzlib=Zn;function Kn(e,t,i){return i||(i=t,t={}),typeof i!="function"&&F(7),ae(e,t,[re,Pn,function(){return[Qe]}],function(n){return Pt(Qe(n.data[0],Ci(n.data[1])))},5,i)}D.unzlib=Kn;function Qe(e,t){return Ee(e.subarray(Ri(e,t&&t.dictionary),-4),{i:2},t&&t.out,t&&t.dictionary)}D.unzlibSync=Qe;var Mi=function(){function e(t,i){this.o=Vt.call(this,t,i)||{},this.G=Xe,this.I=dt,this.Z=$e}return e.prototype.i=function(){var t=this;this.s.ondata=function(i,n){t.ondata(i,n)}},e.prototype.push=function(t,i){if(this.ondata||F(5),this.s)this.s.push(t,i);else{if(this.p&&this.p.length){var n=new G(this.p.length+t.length);n.set(this.p),n.set(t,this.p.length)}else this.p=t;this.p.length>2&&(this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(this.o):(this.p[0]&15)!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(this.o):new this.Z(this.o),this.i(),this.s.push(this.p,i),this.p=null)}},e}();D.Decompress=Mi;var Vr=function(){function e(t,i){Mi.call(this,t,i),this.queuedSize=0,this.G=Gn,this.I=qi,this.Z=Zn}return e.prototype.i=function(){var t=this;this.s.ondata=function(i,n,r){t.ondata(i,n,r)},this.s.ondrain=function(i){t.queuedSize-=i,t.ondrain&&t.ondrain(i)}},e.prototype.push=function(t,i){this.queuedSize+=t.length,Mi.prototype.push.call(this,t,i)},e}();D.AsyncDecompress=Vr;function Gr(e,t,i){return i||(i=t,t={}),typeof i!="function"&&F(7),e[0]==31&&e[1]==139&&e[2]==8?jn(e,t,i):(e[0]&15)!=8||e[0]>>4>7||(e[0]<<8|e[1])%31?ki(e,t,i):Kn(e,t,i)}D.decompress=Gr;function jr(e,t){return e[0]==31&&e[1]==139&&e[2]==8?He(e,t):(e[0]&15)!=8||e[0]>>4>7||(e[0]<<8|e[1])%31?le(e,t):Qe(e,t)}D.decompressSync=jr;var Li=function(e,t,i,n){for(var r in e){var s=e[r],a=t+r,o=n;Array.isArray(s)&&(o=Ae(n,s[1]),s=s[0]),s instanceof G?i[a]=[s,o]:(i[a+="/"]=[new G(0),o],Li(s,a,i,n))}},vn=typeof TextEncoder<"u"&&new TextEncoder,Fi=typeof TextDecoder<"u"&&new TextDecoder,Yn=0;try{Fi.decode(Bt,{stream:!0}),Yn=1}catch{}var Xn=function(e){for(var t="",i=0;;){var n=e[i++],r=(n>127)+(n>223)+(n>239);if(i+r>e.length)return{s:t,r:It(e,i-1)};r?r==3?(n=((n&15)<<18|(e[i++]&63)<<12|(e[i++]&63)<<6|e[i++]&63)-65536,t+=String.fromCharCode(55296|n>>10,56320|n&1023)):r&1?t+=String.fromCharCode((n&31)<<6|e[i++]&63):t+=String.fromCharCode((n&15)<<12|(e[i++]&63)<<6|e[i++]&63):t+=String.fromCharCode(n)}},Zr=function(){function e(t){this.ondata=t,Yn?this.t=new TextDecoder:this.p=Bt}return e.prototype.push=function(t,i){if(this.ondata||F(5),i=!!i,this.t){this.ondata(this.t.decode(t,{stream:!0}),i),i&&(this.t.decode().length&&F(8),this.t=null);return}this.p||F(4);var n=new G(this.p.length+t.length);n.set(this.p),n.set(t,this.p.length);var r=Xn(n),s=r.s,a=r.r;i?(a.length&&F(8),this.p=null):this.p=a,this.ondata(s,i)},e}();D.DecodeUTF8=Zr;var Kr=function(){function e(t){this.ondata=t}return e.prototype.push=function(t,i){this.ondata||F(5),this.d&&F(4),this.ondata(Dt(t),this.d=i||!1)},e}();D.EncodeUTF8=Kr;function Dt(e,t){if(t){for(var i=new G(e.length),n=0;n<e.length;++n)i[n]=e.charCodeAt(n);return i}if(vn)return vn.encode(e);for(var r=e.length,s=new G(e.length+(e.length>>1)),a=0,o=function(d){s[a++]=d},n=0;n<r;++n){if(a+5>s.length){var l=new G(a+8+(r-n<<1));l.set(s),s=l}var f=e.charCodeAt(n);f<128||t?o(f):f<2048?(o(192|f>>6),o(128|f&63)):f>55295&&f<57344?(f=65536+(f&1047552)|e.charCodeAt(++n)&1023,o(240|f>>18),o(128|f>>12&63),o(128|f>>6&63),o(128|f&63)):(o(224|f>>12),o(128|f>>6&63),o(128|f&63))}return It(s,0,a)}D.strToU8=Dt;function Vi(e,t){if(t){for(var i="",n=0;n<e.length;n+=16384)i+=String.fromCharCode.apply(null,e.subarray(n,n+16384));return i}else{if(Fi)return Fi.decode(e);var r=Xn(e),s=r.s,i=r.r;return i.length&&F(8),s}}D.strFromU8=Vi;var Hn=function(e){return e==1?3:e<6?2:e==9?1:0},$n=function(e,t){return t+30+ht(e,t+26)+ht(e,t+28)},Qn=function(e,t,i){var n=ht(e,t+28),r=Vi(e.subarray(t+46,t+46+n),!(ht(e,t+8)&2048)),s=t+46+n,a=nt(e,t+20),o=i&&a==4294967295?Wn(e,s):[a,nt(e,t+24),nt(e,t+42)],l=o[0],f=o[1],d=o[2];return[ht(e,t+10),l,f,r,s+ht(e,t+30)+ht(e,t+32),d]},Wn=function(e,t){for(;ht(e,t)!=1;t+=4+ht(e,t+2));return[wi(e,t+12),wi(e,t+4),wi(e,t+20)]},zt=function(e){var t=0;if(e)for(var i in e){var n=e[i].length;n>65535&&F(9),t+=n+4}return t},Jt=function(e,t,i,n,r,s,a,o){var l=n.length,f=i.extra,d=o&&o.length,h=zt(f);W(e,t,a!=null?33639248:67324752),t+=4,a!=null&&(e[t++]=20,e[t++]=i.os),e[t]=20,t+=2,e[t++]=i.flag<<1|(s<0&&8),e[t++]=r&&8,e[t++]=i.compression&255,e[t++]=i.compression>>8;var v=new Date(i.mtime==null?Date.now():i.mtime),S=v.getFullYear()-1980;if((S<0||S>119)&&F(10),W(e,t,S<<25|v.getMonth()+1<<21|v.getDate()<<16|v.getHours()<<11|v.getMinutes()<<5|v.getSeconds()>>1),t+=4,s!=-1&&(W(e,t,i.crc),W(e,t+4,s<0?-s-2:s),W(e,t+8,i.size)),W(e,t+12,l),W(e,t+14,h),t+=16,a!=null&&(W(e,t,d),W(e,t+6,i.attrs),W(e,t+10,a),t+=14),e.set(n,t),t+=l,h)for(var A in f){var U=f[A],_=U.length;W(e,t,+A),W(e,t+2,_),e.set(U,t+4),t+=4+_}return d&&(e.set(o,t),t+=d),t},Gi=function(e,t,i,n,r){W(e,t,101010256),W(e,t+8,i),W(e,t+10,i),W(e,t+12,n),W(e,t+16,r)},ve=function(){function e(t){this.filename=t,this.c=ne(),this.size=0,this.compression=0}return e.prototype.process=function(t,i){this.ondata(null,t,i)},e.prototype.push=function(t,i){this.ondata||F(5),this.c.p(t),this.size+=t.length,i&&(this.crc=this.c.d()),this.process(t,i||!1)},e}();D.ZipPassThrough=ve;var Yr=function(){function e(t,i){var n=this;i||(i={}),ve.call(this,t),this.d=new Et(i,function(r,s){n.ondata(null,r,s)}),this.compression=8,this.flag=Hn(i.level)}return e.prototype.process=function(t,i){try{this.d.push(t,i)}catch(n){this.ondata(n,null,i)}},e.prototype.push=function(t,i){ve.prototype.push.call(this,t,i)},e}();D.ZipDeflate=Yr;var Xr=function(){function e(t,i){var n=this;i||(i={}),ve.call(this,t),this.d=new qn(i,function(r,s,a){n.ondata(r,s,a)}),this.compression=8,this.flag=Hn(i.level),this.terminate=this.d.terminate}return e.prototype.process=function(t,i){this.d.push(t,i)},e.prototype.push=function(t,i){ve.prototype.push.call(this,t,i)},e}();D.AsyncZipDeflate=Xr;var Hr=function(){function e(t){this.ondata=t,this.u=[],this.d=1}return e.prototype.add=function(t){var i=this;if(this.ondata||F(5),this.d&2)this.ondata(F(4+(this.d&1)*8,0,1),null,!1);else{var n=Dt(t.filename),r=n.length,s=t.comment,a=s&&Dt(s),o=r!=t.filename.length||a&&s.length!=a.length,l=r+zt(t.extra)+30;r>65535&&this.ondata(F(11,0,1),null,!1);var f=new G(l);Jt(f,0,t,n,o,-1);var d=[f],h=function(){for(var _=0,b=d;_<b.length;_++){var B=b[_];i.ondata(null,B,!1)}d=[]},v=this.d;this.d=0;var S=this.u.length,A=Ae(t,{f:n,u:o,o:a,t:function(){t.terminate&&t.terminate()},r:function(){if(h(),v){var _=i.u[S+1];_?_.r():i.d=1}v=1}}),U=0;t.ondata=function(_,b,B){if(_)i.ondata(_,b,B),i.terminate();else if(U+=b.length,d.push(b),B){var N=new G(16);W(N,0,134695760),W(N,4,t.crc),W(N,8,U),W(N,12,t.size),d.push(N),A.c=U,A.b=l+U+16,A.crc=t.crc,A.size=t.size,v&&A.r(),v=1}else v&&h()},this.u.push(A)}},e.prototype.end=function(){var t=this;if(this.d&2){this.ondata(F(4+(this.d&1)*8,0,1),null,!0);return}this.d?this.e():this.u.push({r:function(){t.d&1&&(t.u.splice(-1,1),t.e())},t:function(){}}),this.d=3},e.prototype.e=function(){for(var t=0,i=0,n=0,r=0,s=this.u;r<s.length;r++){var a=s[r];n+=46+a.f.length+zt(a.extra)+(a.o?a.o.length:0)}for(var o=new G(n+22),l=0,f=this.u;l<f.length;l++){var a=f[l];Jt(o,t,a,a.f,a.u,-a.c-2,i,a.o),t+=46+a.f.length+zt(a.extra)+(a.o?a.o.length:0),i+=a.b}Gi(o,t,this.u.length,n,i),this.ondata(null,o,!0),this.d=2},e.prototype.terminate=function(){for(var t=0,i=this.u;t<i.length;t++){var n=i[t];n.t()}this.d=2},e}();D.Zip=Hr;function $r(e,t,i){i||(i=t,t={}),typeof i!="function"&&F(7);var n={};Li(e,"",n,t);var r=Object.keys(n),s=r.length,a=0,o=0,l=s,f=new Array(s),d=[],h=function(){for(var _=0;_<d.length;++_)d[_]()},v=function(_,b){We(function(){i(_,b)})};We(function(){v=i});var S=function(){var _=new G(o+22),b=a,B=o-a;o=0;for(var N=0;N<l;++N){var E=f[N];try{var X=E.c.length;Jt(_,o,E,E.f,E.u,X);var K=30+E.f.length+zt(E.extra),q=o+K;_.set(E.c,q),Jt(_,a,E,E.f,E.u,X,o,E.m),a+=16+K+(E.m?E.m.length:0),o=q+X}catch(O){return v(O,null)}}Gi(_,a,f.length,B,b),v(null,_)};s||S();for(var A=function(_){var b=r[_],B=n[b],N=B[0],E=B[1],X=ne(),K=N.length;X.p(N);var q=Dt(b),O=q.length,T=E.comment,k=T&&Dt(T),j=k&&k.length,V=zt(E.extra),Y=E.level==0?0:8,c=function(I,y){if(I)h(),v(I,null);else{var g=y.length;f[_]=Ae(E,{size:K,crc:X.d(),c:y,f:q,m:k,u:O!=b.length||k&&T.length!=j,compression:Y}),a+=30+O+V+g,o+=76+2*(O+V)+(j||0)+g,--s||S()}};if(O>65535&&c(F(11,0,1),null),!Y)c(null,N);else if(K<16e4)try{c(null,we(N,E))}catch(I){c(I,null)}else d.push(kn(N,E,c))},U=0;U<l;++U)A(U);return h}D.zip=$r;function Qr(e,t){t||(t={});var i={},n=[];Li(e,"",i,t);var r=0,s=0;for(var a in i){var o=i[a],l=o[0],f=o[1],d=f.level==0?0:8,h=Dt(a),v=h.length,S=f.comment,A=S&&Dt(S),U=A&&A.length,_=zt(f.extra);v>65535&&F(11);var b=d?we(l,f):l,B=b.length,N=ne();N.p(l),n.push(Ae(f,{size:l.length,crc:N.d(),c:b,f:h,m:A,u:v!=a.length||A&&S.length!=U,o:r,compression:d})),r+=30+v+_+B,s+=76+2*(v+_)+(U||0)+B}for(var E=new G(s+22),X=r,K=s-r,q=0;q<n.length;++q){var h=n[q];Jt(E,h.o,h,h.f,h.u,h.c.length);var O=30+h.f.length+zt(h.extra);E.set(h.c,h.o+O),Jt(E,r,h,h.f,h.u,h.c.length,h.o,h.m),r+=16+O+(h.m?h.m.length:0)}return Gi(E,r,n.length,K,X),E}D.zipSync=Qr;var Jn=function(){function e(){}return e.prototype.push=function(t,i){this.ondata(null,t,i)},e.compression=0,e}();D.UnzipPassThrough=Jn;var Wr=function(){function e(){var t=this;this.i=new dt(function(i,n){t.ondata(null,i,n)})}return e.prototype.push=function(t,i){try{this.i.push(t,i)}catch(n){this.ondata(n,null,i)}},e.compression=8,e}();D.UnzipInflate=Wr;var Jr=function(){function e(t,i){var n=this;i<32e4?this.i=new dt(function(r,s){n.ondata(null,r,s)}):(this.i=new qi(function(r,s,a){n.ondata(r,s,a)}),this.terminate=this.i.terminate)}return e.prototype.push=function(t,i){this.i.terminate&&(t=It(t,0)),this.i.push(t,i)},e.compression=8,e}();D.AsyncUnzipInflate=Jr;var ts=function(){function e(t){this.onfile=t,this.k=[],this.o={0:Jn},this.p=Bt}return e.prototype.push=function(t,i){var n=this;if(this.onfile||F(5),this.p||F(4),this.c>0){var r=Math.min(this.c,t.length),s=t.subarray(0,r);if(this.c-=r,this.d?this.d.push(s,!this.c):this.k[0].push(s),t=t.subarray(r),t.length)return this.push(t,i)}else{var a=0,o=0,l=void 0,f=void 0;this.p.length?t.length?(f=new G(this.p.length+t.length),f.set(this.p),f.set(t,this.p.length)):f=this.p:f=t;for(var d=f.length,h=this.c,v=h&&this.d,S=function(){var b,B=nt(f,o);if(B==67324752){a=1,l=o,A.d=null,A.c=0;var N=ht(f,o+6),E=ht(f,o+8),X=N&2048,K=N&8,q=ht(f,o+26),O=ht(f,o+28);if(d>o+30+q+O){var T=[];A.k.unshift(T),a=2;var k=nt(f,o+18),j=nt(f,o+22),V=Vi(f.subarray(o+30,o+=30+q),!X);k==4294967295?(b=K?[-2]:Wn(f,o),k=b[0],j=b[1]):K&&(k=-1),o+=O,A.c=k;var Y,c={name:V,compression:E,start:function(){if(c.ondata||F(5),!k)c.ondata(null,Bt,!0);else{var I=n.o[E];I||c.ondata(F(14,"unknown compression type "+E,1),null,!1),Y=k<0?new I(V):new I(V,k,j),Y.ondata=function(w,z,C){c.ondata(w,z,C)};for(var y=0,g=T;y<g.length;y++){var m=g[y];Y.push(m,!1)}n.k[0]==T&&n.c?n.d=Y:Y.push(Bt,!0)}},terminate:function(){Y&&Y.terminate&&Y.terminate()}};k>=0&&(c.size=k,c.originalSize=j),A.onfile(c)}return"break"}else if(h){if(B==134695760)return l=o+=12+(h==-2&&8),a=3,A.c=0,"break";if(B==33639248)return l=o-=4,a=3,A.c=0,"break"}},A=this;o<d-4;++o){var U=S();if(U==="break")break}if(this.p=Bt,h<0){var _=a?f.subarray(0,l-12-(h==-2&&8)-(nt(f,l-16)==134695760&&4)):f.subarray(0,o);v?v.push(_,!!a):this.k[+(a==2)].push(_)}if(a&2)return this.push(f.subarray(o),i);this.p=f.subarray(o)}i&&(this.c&&F(13),this.p=null)},e.prototype.register=function(t){this.o[t.compression]=t},e}();D.Unzip=ts;var We=typeof queueMicrotask=="function"?queueMicrotask:typeof setTimeout=="function"?setTimeout:function(e){e()};function es(e,t,i){i||(i=t,t={}),typeof i!="function"&&F(7);var n=[],r=function(){for(var _=0;_<n.length;++_)n[_]()},s={},a=function(_,b){We(function(){i(_,b)})};We(function(){a=i});for(var o=e.length-22;nt(e,o)!=101010256;--o)if(!o||e.length-o>65558)return a(F(13,0,1),null),r;var l=ht(e,o+8);if(l){var f=l,d=nt(e,o+16),h=d==4294967295||f==65535;if(h){var v=nt(e,o-12);h=nt(e,v)==101075792,h&&(f=l=nt(e,v+32),d=nt(e,v+48))}for(var S=t&&t.filter,A=function(_){var b=Qn(e,d,h),B=b[0],N=b[1],E=b[2],X=b[3],K=b[4],q=b[5],O=$n(e,q);d=K;var T=function(j,V){j?(r(),a(j,null)):(V&&(s[X]=V),--l||a(null,s))};if(!S||S({name:X,size:N,originalSize:E,compression:B}))if(!B)T(null,It(e,O,O+N));else if(B==8){var k=e.subarray(O,O+N);if(E<524288||N>.8*E)try{T(null,le(k,{out:new G(E)}))}catch(j){T(j,null)}else n.push(ki(k,{size:E},T))}else T(F(14,"unknown compression type "+B,1),null);else T(null,null)},U=0;U<f;++U)A(U)}else a(null,{});return r}D.unzip=es;function is(e,t){for(var i={},n=e.length-22;nt(e,n)!=101010256;--n)(!n||e.length-n>65558)&&F(13);var r=ht(e,n+8);if(!r)return{};var s=nt(e,n+16),a=s==4294967295||r==65535;if(a){var o=nt(e,n-12);a=nt(e,o)==101075792,a&&(r=nt(e,o+32),s=nt(e,o+48))}for(var l=t&&t.filter,f=0;f<r;++f){var d=Qn(e,s,a),h=d[0],v=d[1],S=d[2],A=d[3],U=d[4],_=d[5],b=$n(e,_);s=U,(!l||l({name:A,size:v,originalSize:S,compression:h}))&&(h?h==8?i[A]=le(e.subarray(b,b+v),{out:new G(S)}):F(14,"unknown compression type "+h):i[A]=It(e,b,b+v))}return i}D.unzipSync=is});var Zi=Kt(ti=>{"use strict";Object.defineProperty(ti,"__esModule",{value:!0});ti.NIFTIEXTENSION=void 0;var ji=class{esize;ecode;edata;littleEndian;constructor(t,i,n,r){if(t%16!=0)throw new Error("This does not appear to be a NIFTI extension");this.esize=t,this.ecode=i,this.edata=n,this.littleEndian=r}toArrayBuffer(){let t=new Uint8Array(this.esize),i=new Uint8Array(this.edata);t.set(i,8);let n=new DataView(t.buffer);return n.setInt32(0,this.esize,this.littleEndian),n.setInt32(4,this.ecode,this.littleEndian),t.buffer}};ti.NIFTIEXTENSION=ji});var _e=Kt(ei=>{"use strict";Object.defineProperty(ei,"__esModule",{value:!0});ei.Utils=void 0;var ns=Zi(),Ki=class e{static crcTable=null;static GUNZIP_MAGIC_COOKIE1=31;static GUNZIP_MAGIC_COOKIE2=139;static getStringAt(t,i,n){var r="",s,a;for(s=i;s<n;s+=1)a=t.getUint8(s),a!==0&&(r+=String.fromCharCode(a));return r}static getByteAt=function(t,i){return t.getInt8(i)};static getShortAt=function(t,i,n){return t.getInt16(i,n)};static getIntAt(t,i,n){return t.getInt32(i,n)}static getFloatAt(t,i,n){return t.getFloat32(i,n)}static getDoubleAt(t,i,n){return t.getFloat64(i,n)}static getLongAt(t,i,n){var r,s=[],a=0;for(r=0;r<8;r+=1)s[r]=e.getByteAt(t,i+r);for(r=s.length-1;r>=0;r--)a=a*256+s[r];return a}static getExtensionsAt(t,i,n,r){let s=[],a=i;for(;a<r;){let o=n,l=e.getIntAt(t,a,n);if(!l)break;if(l+a>r&&(o=!o,l=e.getIntAt(t,a,o),l+a>r))throw new Error("This does not appear to be a valid NIFTI extension");if(l%16!=0)throw new Error("This does not appear to be a NIFTI extension");let f=e.getIntAt(t,a+4,o),d=t.buffer.slice(a+8,a+l);console.log("extensionByteIndex: "+(a+8)+" esize: "+l),console.log(d);let h=new ns.NIFTIEXTENSION(l,f,d,o);s.push(h),a+=l}return s}static toArrayBuffer(t){var i,n,r;for(i=new ArrayBuffer(t.length),n=new Uint8Array(i),r=0;r<t.length;r+=1)n[r]=t[r];return i}static isString(t){return typeof t=="string"||t instanceof String}static formatNumber(t,i=void 0){let n;return e.isString(t)?n=Number(t):n=t,i?n=n.toPrecision(5):n=n.toPrecision(7),parseFloat(n)}static makeCRCTable(){let t,i=[];for(var n=0;n<256;n++){t=n;for(var r=0;r<8;r++)t=t&1?3988292384^t>>>1:t>>>1;i[n]=t}return i}static crc32(t){e.crcTable||(e.crcTable=e.makeCRCTable());let i=e.crcTable,n=-1;for(var r=0;r<t.byteLength;r++)n=n>>>8^i[(n^t.getUint8(r))&255];return(n^-1)>>>0}};ei.Utils=Ki});var ni=Kt(ii=>{"use strict";Object.defineProperty(ii,"__esModule",{value:!0});ii.NIFTI1=void 0;var L=_e(),Yi=class e{littleEndian=!1;dim_info=0;dims=[];intent_p1=0;intent_p2=0;intent_p3=0;intent_code=0;datatypeCode=0;numBitsPerVoxel=0;slice_start=0;slice_end=0;slice_code=0;pixDims=[];vox_offset=0;scl_slope=1;scl_inter=0;xyzt_units=0;cal_max=0;cal_min=0;slice_duration=0;toffset=0;description="";aux_file="";intent_name="";qform_code=0;sform_code=0;quatern_a=0;quatern_b=0;quatern_c=0;quatern_d=0;qoffset_x=0;qoffset_y=0;qoffset_z=0;affine=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];qfac=1;quatern_R;magic="0";isHDR=!1;extensionFlag=[0,0,0,0];extensionSize=0;extensionCode=0;extensions=[];static TYPE_NONE=0;static TYPE_BINARY=1;static TYPE_UINT8=2;static TYPE_INT16=4;static TYPE_INT32=8;static TYPE_FLOAT32=16;static TYPE_COMPLEX64=32;static TYPE_FLOAT64=64;static TYPE_RGB24=128;static TYPE_INT8=256;static TYPE_UINT16=512;static TYPE_UINT32=768;static TYPE_INT64=1024;static TYPE_UINT64=1280;static TYPE_FLOAT128=1536;static TYPE_COMPLEX128=1792;static TYPE_COMPLEX256=2048;static XFORM_UNKNOWN=0;static XFORM_SCANNER_ANAT=1;static XFORM_ALIGNED_ANAT=2;static XFORM_TALAIRACH=3;static XFORM_MNI_152=4;static SPATIAL_UNITS_MASK=7;static TEMPORAL_UNITS_MASK=56;static UNITS_UNKNOWN=0;static UNITS_METER=1;static UNITS_MM=2;static UNITS_MICRON=3;static UNITS_SEC=8;static UNITS_MSEC=16;static UNITS_USEC=24;static UNITS_HZ=32;static UNITS_PPM=40;static UNITS_RADS=48;static MAGIC_COOKIE=348;static STANDARD_HEADER_SIZE=348;static MAGIC_NUMBER_LOCATION=344;static MAGIC_NUMBER=[110,43,49];static MAGIC_NUMBER2=[110,105,49];static EXTENSION_HEADER_SIZE=8;readHeader(t){var i=new DataView(t),n=L.Utils.getIntAt(i,0,this.littleEndian),r,s,a,o;if(n!==e.MAGIC_COOKIE&&(this.littleEndian=!0,n=L.Utils.getIntAt(i,0,this.littleEndian)),n!==e.MAGIC_COOKIE)throw new Error("This does not appear to be a NIFTI file!");for(this.dim_info=L.Utils.getByteAt(i,39),r=0;r<8;r+=1)o=40+r*2,this.dims[r]=L.Utils.getShortAt(i,o,this.littleEndian);for(this.intent_p1=L.Utils.getFloatAt(i,56,this.littleEndian),this.intent_p2=L.Utils.getFloatAt(i,60,this.littleEndian),this.intent_p3=L.Utils.getFloatAt(i,64,this.littleEndian),this.intent_code=L.Utils.getShortAt(i,68,this.littleEndian),this.datatypeCode=L.Utils.getShortAt(i,70,this.littleEndian),this.numBitsPerVoxel=L.Utils.getShortAt(i,72,this.littleEndian),this.slice_start=L.Utils.getShortAt(i,74,this.littleEndian),r=0;r<8;r+=1)o=76+r*4,this.pixDims[r]=L.Utils.getFloatAt(i,o,this.littleEndian);if(this.vox_offset=L.Utils.getFloatAt(i,108,this.littleEndian),this.scl_slope=L.Utils.getFloatAt(i,112,this.littleEndian),this.scl_inter=L.Utils.getFloatAt(i,116,this.littleEndian),this.slice_end=L.Utils.getShortAt(i,120,this.littleEndian),this.slice_code=L.Utils.getByteAt(i,122),this.xyzt_units=L.Utils.getByteAt(i,123),this.cal_max=L.Utils.getFloatAt(i,124,this.littleEndian),this.cal_min=L.Utils.getFloatAt(i,128,this.littleEndian),this.slice_duration=L.Utils.getFloatAt(i,132,this.littleEndian),this.toffset=L.Utils.getFloatAt(i,136,this.littleEndian),this.description=L.Utils.getStringAt(i,148,228),this.aux_file=L.Utils.getStringAt(i,228,252),this.qform_code=L.Utils.getShortAt(i,252,this.littleEndian),this.sform_code=L.Utils.getShortAt(i,254,this.littleEndian),this.quatern_b=L.Utils.getFloatAt(i,256,this.littleEndian),this.quatern_c=L.Utils.getFloatAt(i,260,this.littleEndian),this.quatern_d=L.Utils.getFloatAt(i,264,this.littleEndian),this.quatern_a=Math.sqrt(1-(Math.pow(this.quatern_b,2)+Math.pow(this.quatern_c,2)+Math.pow(this.quatern_d,2))),this.qoffset_x=L.Utils.getFloatAt(i,268,this.littleEndian),this.qoffset_y=L.Utils.getFloatAt(i,272,this.littleEndian),this.qoffset_z=L.Utils.getFloatAt(i,276,this.littleEndian),this.qform_code<1&&this.sform_code<1&&(this.affine[0][0]=this.pixDims[1],this.affine[1][1]=this.pixDims[2],this.affine[2][2]=this.pixDims[3]),this.qform_code>0&&this.sform_code<this.qform_code){let l=this.quatern_a,f=this.quatern_b,d=this.quatern_c,h=this.quatern_d;for(this.qfac=this.pixDims[0]===0?1:this.pixDims[0],this.quatern_R=[[l*l+f*f-d*d-h*h,2*f*d-2*l*h,2*f*h+2*l*d],[2*f*d+2*l*h,l*l+d*d-f*f-h*h,2*d*h-2*l*f],[2*f*h-2*l*d,2*d*h+2*l*f,l*l+h*h-d*d-f*f]],s=0;s<3;s+=1)for(a=0;a<3;a+=1)this.affine[s][a]=this.quatern_R[s][a]*this.pixDims[a+1],a===2&&(this.affine[s][a]*=this.qfac);this.affine[0][3]=this.qoffset_x,this.affine[1][3]=this.qoffset_y,this.affine[2][3]=this.qoffset_z}else if(this.sform_code>0)for(s=0;s<3;s+=1)for(a=0;a<4;a+=1)o=280+(s*4+a)*4,this.affine[s][a]=L.Utils.getFloatAt(i,o,this.littleEndian);if(this.affine[3][0]=0,this.affine[3][1]=0,this.affine[3][2]=0,this.affine[3][3]=1,this.intent_name=L.Utils.getStringAt(i,328,344),this.magic=L.Utils.getStringAt(i,344,348),this.isHDR=this.magic===String.fromCharCode.apply(null,e.MAGIC_NUMBER2),i.byteLength>e.MAGIC_COOKIE){this.extensionFlag[0]=L.Utils.getByteAt(i,348),this.extensionFlag[1]=L.Utils.getByteAt(i,349),this.extensionFlag[2]=L.Utils.getByteAt(i,350),this.extensionFlag[3]=L.Utils.getByteAt(i,351);let l=!0;!this.isHDR&&this.vox_offset<=352&&(l=!1),i.byteLength<=368&&(l=!1),l&&this.extensionFlag[0]&&(this.extensions=L.Utils.getExtensionsAt(i,this.getExtensionLocation(),this.littleEndian,this.vox_offset),this.extensionSize=this.extensions[0].esize,this.extensionCode=this.extensions[0].ecode)}}toFormattedString(){var t=L.Utils.formatNumber,i="";return i+="Dim Info = "+this.dim_info+`
`,i+="Image Dimensions (1-8): "+this.dims[0]+", "+this.dims[1]+", "+this.dims[2]+", "+this.dims[3]+", "+this.dims[4]+", "+this.dims[5]+", "+this.dims[6]+", "+this.dims[7]+`
`,i+="Intent Parameters (1-3): "+this.intent_p1+", "+this.intent_p2+", "+this.intent_p3+`
`,i+="Intent Code = "+this.intent_code+`
`,i+="Datatype = "+this.datatypeCode+" ("+this.getDatatypeCodeString(this.datatypeCode)+`)
`,i+="Bits Per Voxel = "+this.numBitsPerVoxel+`
`,i+="Slice Start = "+this.slice_start+`
`,i+="Voxel Dimensions (1-8): "+t(this.pixDims[0])+", "+t(this.pixDims[1])+", "+t(this.pixDims[2])+", "+t(this.pixDims[3])+", "+t(this.pixDims[4])+", "+t(this.pixDims[5])+", "+t(this.pixDims[6])+", "+t(this.pixDims[7])+`
`,i+="Image Offset = "+this.vox_offset+`
`,i+="Data Scale:  Slope = "+t(this.scl_slope)+"  Intercept = "+t(this.scl_inter)+`
`,i+="Slice End = "+this.slice_end+`
`,i+="Slice Code = "+this.slice_code+`
`,i+="Units Code = "+this.xyzt_units+" ("+this.getUnitsCodeString(e.SPATIAL_UNITS_MASK&this.xyzt_units)+", "+this.getUnitsCodeString(e.TEMPORAL_UNITS_MASK&this.xyzt_units)+`)
`,i+="Display Range:  Max = "+t(this.cal_max)+"  Min = "+t(this.cal_min)+`
`,i+="Slice Duration = "+this.slice_duration+`
`,i+="Time Axis Shift = "+this.toffset+`
`,i+='Description: "'+this.description+`"
`,i+='Auxiliary File: "'+this.aux_file+`"
`,i+="Q-Form Code = "+this.qform_code+" ("+this.getTransformCodeString(this.qform_code)+`)
`,i+="S-Form Code = "+this.sform_code+" ("+this.getTransformCodeString(this.sform_code)+`)
`,i+="Quaternion Parameters:  b = "+t(this.quatern_b)+"  c = "+t(this.quatern_c)+"  d = "+t(this.quatern_d)+`
`,i+="Quaternion Offsets:  x = "+this.qoffset_x+"  y = "+this.qoffset_y+"  z = "+this.qoffset_z+`
`,i+="S-Form Parameters X: "+t(this.affine[0][0])+", "+t(this.affine[0][1])+", "+t(this.affine[0][2])+", "+t(this.affine[0][3])+`
`,i+="S-Form Parameters Y: "+t(this.affine[1][0])+", "+t(this.affine[1][1])+", "+t(this.affine[1][2])+", "+t(this.affine[1][3])+`
`,i+="S-Form Parameters Z: "+t(this.affine[2][0])+", "+t(this.affine[2][1])+", "+t(this.affine[2][2])+", "+t(this.affine[2][3])+`
`,i+='Intent Name: "'+this.intent_name+`"
`,this.extensionFlag[0]&&(i+="Extension: Size = "+this.extensionSize+"  Code = "+this.extensionCode+`
`),i}getDatatypeCodeString=function(t){return t===e.TYPE_UINT8?"1-Byte Unsigned Integer":t===e.TYPE_INT16?"2-Byte Signed Integer":t===e.TYPE_INT32?"4-Byte Signed Integer":t===e.TYPE_FLOAT32?"4-Byte Float":t===e.TYPE_FLOAT64?"8-Byte Float":t===e.TYPE_RGB24?"RGB":t===e.TYPE_INT8?"1-Byte Signed Integer":t===e.TYPE_UINT16?"2-Byte Unsigned Integer":t===e.TYPE_UINT32?"4-Byte Unsigned Integer":t===e.TYPE_INT64?"8-Byte Signed Integer":t===e.TYPE_UINT64?"8-Byte Unsigned Integer":"Unknown"};getTransformCodeString=function(t){return t===e.XFORM_SCANNER_ANAT?"Scanner":t===e.XFORM_ALIGNED_ANAT?"Aligned":t===e.XFORM_TALAIRACH?"Talairach":t===e.XFORM_MNI_152?"MNI":"Unknown"};getUnitsCodeString=function(t){return t===e.UNITS_METER?"Meters":t===e.UNITS_MM?"Millimeters":t===e.UNITS_MICRON?"Microns":t===e.UNITS_SEC?"Seconds":t===e.UNITS_MSEC?"Milliseconds":t===e.UNITS_USEC?"Microseconds":t===e.UNITS_HZ?"Hz":t===e.UNITS_PPM?"PPM":t===e.UNITS_RADS?"Rads":"Unknown"};getQformMat(){return this.convertNiftiQFormToNiftiSForm(this.quatern_b,this.quatern_c,this.quatern_d,this.qoffset_x,this.qoffset_y,this.qoffset_z,this.pixDims[1],this.pixDims[2],this.pixDims[3],this.pixDims[0])}convertNiftiQFormToNiftiSForm(t,i,n,r,s,a,o,l,f,d){var h=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],v,S=t,A=i,U=n,_,b,B;return h[3][0]=h[3][1]=h[3][2]=0,h[3][3]=1,v=1-(S*S+A*A+U*U),v<1e-7?(v=1/Math.sqrt(S*S+A*A+U*U),S*=v,A*=v,U*=v,v=0):v=Math.sqrt(v),_=o>0?o:1,b=l>0?l:1,B=f>0?f:1,d<0&&(B=-B),h[0][0]=(v*v+S*S-A*A-U*U)*_,h[0][1]=2*(S*A-v*U)*b,h[0][2]=2*(S*U+v*A)*B,h[1][0]=2*(S*A+v*U)*_,h[1][1]=(v*v+A*A-S*S-U*U)*b,h[1][2]=2*(A*U-v*S)*B,h[2][0]=2*(S*U-v*A)*_,h[2][1]=2*(A*U+v*S)*b,h[2][2]=(v*v+U*U-A*A-S*S)*B,h[0][3]=r,h[1][3]=s,h[2][3]=a,h}convertNiftiSFormToNEMA(t){var i,n,r,s,a,o,l,f,d,h,v,S,A,U,_,b,B,N,E,X,K,q,O,T,k,j,V,Y,c,I,y,g,m,w;if(_=0,V=[[0,0,0],[0,0,0],[0,0,0]],Y=[[0,0,0],[0,0,0],[0,0,0]],i=t[0][0],n=t[0][1],r=t[0][2],s=t[1][0],a=t[1][1],o=t[1][2],l=t[2][0],f=t[2][1],d=t[2][2],h=Math.sqrt(i*i+s*s+l*l),h===0||(i/=h,s/=h,l/=h,h=Math.sqrt(n*n+a*a+f*f),h===0))return null;if(n/=h,a/=h,f/=h,h=i*n+s*a+l*f,Math.abs(h)>1e-4){if(n-=h*i,a-=h*s,f-=h*l,h=Math.sqrt(n*n+a*a+f*f),h===0)return null;n/=h,a/=h,f/=h}if(h=Math.sqrt(r*r+o*o+d*d),h===0?(r=s*f-l*a,o=l*n-f*i,d=i*a-s*n):(r/=h,o/=h,d/=h),h=i*r+s*o+l*d,Math.abs(h)>1e-4){if(r-=h*i,o-=h*s,d-=h*l,h=Math.sqrt(r*r+o*o+d*d),h===0)return null;r/=h,o/=h,d/=h}if(h=n*r+a*o+f*d,Math.abs(h)>1e-4){if(r-=h*n,o-=h*a,d-=h*f,h=Math.sqrt(r*r+o*o+d*d),h===0)return null;r/=h,o/=h,d/=h}if(V[0][0]=i,V[0][1]=n,V[0][2]=r,V[1][0]=s,V[1][1]=a,V[1][2]=o,V[2][0]=l,V[2][1]=f,V[2][2]=d,v=this.nifti_mat33_determ(V),v===0)return null;for(j=-666,E=q=O=T=1,X=2,K=3,A=1;A<=3;A+=1)for(U=1;U<=3;U+=1)if(A!==U){for(_=1;_<=3;_+=1)if(!(A===_||U===_))for(Y[0][0]=Y[0][1]=Y[0][2]=Y[1][0]=Y[1][1]=Y[1][2]=Y[2][0]=Y[2][1]=Y[2][2]=0,b=-1;b<=1;b+=2)for(B=-1;B<=1;B+=2)for(N=-1;N<=1;N+=2)Y[0][A-1]=b,Y[1][U-1]=B,Y[2][_-1]=N,S=this.nifti_mat33_determ(Y),S*v>0&&(k=this.nifti_mat33_mul(Y,V),h=k[0][0]+k[1][1]+k[2][2],h>j&&(j=h,E=A,X=U,K=_,q=b,O=B,T=N))}switch(c=I=y=g=m=w="",E*q){case 1:c="X",g="+";break;case-1:c="X",g="-";break;case 2:c="Y",g="+";break;case-2:c="Y",g="-";break;case 3:c="Z",g="+";break;case-3:c="Z",g="-";break}switch(X*O){case 1:I="X",m="+";break;case-1:I="X",m="-";break;case 2:I="Y",m="+";break;case-2:I="Y",m="-";break;case 3:I="Z",m="+";break;case-3:I="Z",m="-";break}switch(K*T){case 1:y="X",w="+";break;case-1:y="X",w="-";break;case 2:y="Y",w="+";break;case-2:y="Y",w="-";break;case 3:y="Z",w="+";break;case-3:y="Z",w="-";break}return c+I+y+g+m+w}nifti_mat33_mul=function(t,i){var n=[[0,0,0],[0,0,0],[0,0,0]],r,s;for(r=0;r<3;r+=1)for(s=0;s<3;s+=1)n[r][s]=t[r][0]*i[0][s]+t[r][1]*i[1][s]+t[r][2]*i[2][s];return n};nifti_mat33_determ=function(t){var i,n,r,s,a,o,l,f,d;return i=t[0][0],n=t[0][1],r=t[0][2],s=t[1][0],a=t[1][1],o=t[1][2],l=t[2][0],f=t[2][1],d=t[2][2],i*a*d-i*f*o-s*n*d+s*f*r+l*n*o-l*a*r};getExtensionLocation(){return e.MAGIC_COOKIE+4}getExtensionSize(t){return L.Utils.getIntAt(t,this.getExtensionLocation(),this.littleEndian)}getExtensionCode(t){return L.Utils.getIntAt(t,this.getExtensionLocation()+4,this.littleEndian)}addExtension(t,i=-1){i==-1?this.extensions.push(t):this.extensions.splice(i,0,t),this.vox_offset+=t.esize}removeExtension(t){let i=this.extensions[t];i&&(this.vox_offset-=i.esize),this.extensions.splice(t,1)}toArrayBuffer(t=!1){let r=352;if(t)for(let l of this.extensions)r+=l.esize;let s=new Uint8Array(r),a=new DataView(s.buffer);a.setInt32(0,348,this.littleEndian),a.setUint8(39,this.dim_info);for(let l=0;l<8;l++)a.setUint16(40+2*l,this.dims[l],this.littleEndian);a.setFloat32(56,this.intent_p1,this.littleEndian),a.setFloat32(60,this.intent_p2,this.littleEndian),a.setFloat32(64,this.intent_p3,this.littleEndian),a.setInt16(68,this.intent_code,this.littleEndian),a.setInt16(70,this.datatypeCode,this.littleEndian),a.setInt16(72,this.numBitsPerVoxel,this.littleEndian),a.setInt16(74,this.slice_start,this.littleEndian);for(let l=0;l<8;l++)a.setFloat32(76+4*l,this.pixDims[l],this.littleEndian);a.setFloat32(108,this.vox_offset,this.littleEndian),a.setFloat32(112,this.scl_slope,this.littleEndian),a.setFloat32(116,this.scl_inter,this.littleEndian),a.setInt16(120,this.slice_end,this.littleEndian),a.setUint8(122,this.slice_code),a.setUint8(123,this.xyzt_units),a.setFloat32(124,this.cal_max,this.littleEndian),a.setFloat32(128,this.cal_min,this.littleEndian),a.setFloat32(132,this.slice_duration,this.littleEndian),a.setFloat32(136,this.toffset,this.littleEndian),s.set(Buffer.from(this.description),148),s.set(Buffer.from(this.aux_file),228),a.setInt16(252,this.qform_code,this.littleEndian),a.setInt16(254,this.sform_code,this.littleEndian),a.setFloat32(256,this.quatern_b,this.littleEndian),a.setFloat32(260,this.quatern_c,this.littleEndian),a.setFloat32(264,this.quatern_d,this.littleEndian),a.setFloat32(268,this.qoffset_x,this.littleEndian),a.setFloat32(272,this.qoffset_y,this.littleEndian),a.setFloat32(276,this.qoffset_z,this.littleEndian);let o=this.affine.flat();for(let l=0;l<12;l++)a.setFloat32(280+4*l,o[l],this.littleEndian);if(s.set(Buffer.from(this.intent_name),328),s.set(Buffer.from(this.magic),344),t){s.set(Uint8Array.from([1,0,0,0]),348);let l=this.getExtensionLocation();for(let f of this.extensions)a.setInt32(l,f.esize,f.littleEndian),a.setInt32(l+4,f.ecode,f.littleEndian),s.set(new Uint8Array(f.edata),l+8),l+=f.esize}else s.set(new Uint8Array(4).fill(0),348);return s.buffer}};ii.NIFTI1=Yi});var Hi=Kt(ri=>{"use strict";Object.defineProperty(ri,"__esModule",{value:!0});ri.NIFTI2=void 0;var pt=ni(),Z=_e(),Xi=class e{littleEndian=!1;dim_info=0;dims=[];intent_p1=0;intent_p2=0;intent_p3=0;intent_code=0;datatypeCode=0;numBitsPerVoxel=0;slice_start=0;slice_end=0;slice_code=0;pixDims=[];vox_offset=0;scl_slope=1;scl_inter=0;xyzt_units=0;cal_max=0;cal_min=0;slice_duration=0;toffset=0;description="";aux_file="";intent_name="";qform_code=0;sform_code=0;quatern_b=0;quatern_c=0;quatern_d=0;qoffset_x=0;qoffset_y=0;qoffset_z=0;affine=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];magic="0";extensionFlag=[0,0,0,0];extensions=[];extensionSize=0;extensionCode=0;static MAGIC_COOKIE=540;static MAGIC_NUMBER_LOCATION=4;static MAGIC_NUMBER=[110,43,50,0,13,10,26,10];static MAGIC_NUMBER2=[110,105,50,0,13,10,26,10];readHeader(t){var i=new DataView(t),n=Z.Utils.getIntAt(i,0,this.littleEndian),r,s,a,o,l;if(n!==e.MAGIC_COOKIE&&(this.littleEndian=!0,n=Z.Utils.getIntAt(i,0,this.littleEndian)),n!==e.MAGIC_COOKIE)throw new Error("This does not appear to be a NIFTI file!");for(this.magic=Z.Utils.getStringAt(i,4,12),this.datatypeCode=Z.Utils.getShortAt(i,12,this.littleEndian),this.numBitsPerVoxel=Z.Utils.getShortAt(i,14,this.littleEndian),r=0;r<8;r+=1)o=16+r*8,this.dims[r]=Z.Utils.getLongAt(i,o,this.littleEndian);for(this.intent_p1=Z.Utils.getDoubleAt(i,80,this.littleEndian),this.intent_p2=Z.Utils.getDoubleAt(i,88,this.littleEndian),this.intent_p3=Z.Utils.getDoubleAt(i,96,this.littleEndian),r=0;r<8;r+=1)o=104+r*8,this.pixDims[r]=Z.Utils.getDoubleAt(i,o,this.littleEndian);for(this.vox_offset=Z.Utils.getLongAt(i,168,this.littleEndian),this.scl_slope=Z.Utils.getDoubleAt(i,176,this.littleEndian),this.scl_inter=Z.Utils.getDoubleAt(i,184,this.littleEndian),this.cal_max=Z.Utils.getDoubleAt(i,192,this.littleEndian),this.cal_min=Z.Utils.getDoubleAt(i,200,this.littleEndian),this.slice_duration=Z.Utils.getDoubleAt(i,208,this.littleEndian),this.toffset=Z.Utils.getDoubleAt(i,216,this.littleEndian),this.slice_start=Z.Utils.getLongAt(i,224,this.littleEndian),this.slice_end=Z.Utils.getLongAt(i,232,this.littleEndian),this.description=Z.Utils.getStringAt(i,240,320),this.aux_file=Z.Utils.getStringAt(i,320,344),this.qform_code=Z.Utils.getIntAt(i,344,this.littleEndian),this.sform_code=Z.Utils.getIntAt(i,348,this.littleEndian),this.quatern_b=Z.Utils.getDoubleAt(i,352,this.littleEndian),this.quatern_c=Z.Utils.getDoubleAt(i,360,this.littleEndian),this.quatern_d=Z.Utils.getDoubleAt(i,368,this.littleEndian),this.qoffset_x=Z.Utils.getDoubleAt(i,376,this.littleEndian),this.qoffset_y=Z.Utils.getDoubleAt(i,384,this.littleEndian),this.qoffset_z=Z.Utils.getDoubleAt(i,392,this.littleEndian),s=0;s<3;s+=1)for(a=0;a<4;a+=1)o=400+(s*4+a)*8,this.affine[s][a]=Z.Utils.getDoubleAt(i,o,this.littleEndian);this.affine[3][0]=0,this.affine[3][1]=0,this.affine[3][2]=0,this.affine[3][3]=1,this.slice_code=Z.Utils.getIntAt(i,496,this.littleEndian),this.xyzt_units=Z.Utils.getIntAt(i,500,this.littleEndian),this.intent_code=Z.Utils.getIntAt(i,504,this.littleEndian),this.intent_name=Z.Utils.getStringAt(i,508,524),this.dim_info=Z.Utils.getByteAt(i,524),i.byteLength>e.MAGIC_COOKIE&&(this.extensionFlag[0]=Z.Utils.getByteAt(i,540),this.extensionFlag[1]=Z.Utils.getByteAt(i,541),this.extensionFlag[2]=Z.Utils.getByteAt(i,542),this.extensionFlag[3]=Z.Utils.getByteAt(i,543),this.extensionFlag[0]&&(this.extensions=Z.Utils.getExtensionsAt(i,this.getExtensionLocation(),this.littleEndian,this.vox_offset),this.extensionSize=this.extensions[0].esize,this.extensionCode=this.extensions[0].ecode))}toFormattedString(){var t=Z.Utils.formatNumber,i="";return i+="Datatype = "+ +this.datatypeCode+" ("+this.getDatatypeCodeString(this.datatypeCode)+`)
`,i+="Bits Per Voxel =  = "+this.numBitsPerVoxel+`
`,i+="Image Dimensions (1-8): "+this.dims[0]+", "+this.dims[1]+", "+this.dims[2]+", "+this.dims[3]+", "+this.dims[4]+", "+this.dims[5]+", "+this.dims[6]+", "+this.dims[7]+`
`,i+="Intent Parameters (1-3): "+this.intent_p1+", "+this.intent_p2+", "+this.intent_p3+`
`,i+="Voxel Dimensions (1-8): "+t(this.pixDims[0])+", "+t(this.pixDims[1])+", "+t(this.pixDims[2])+", "+t(this.pixDims[3])+", "+t(this.pixDims[4])+", "+t(this.pixDims[5])+", "+t(this.pixDims[6])+", "+t(this.pixDims[7])+`
`,i+="Image Offset = "+this.vox_offset+`
`,i+="Data Scale:  Slope = "+t(this.scl_slope)+"  Intercept = "+t(this.scl_inter)+`
`,i+="Display Range:  Max = "+t(this.cal_max)+"  Min = "+t(this.cal_min)+`
`,i+="Slice Duration = "+this.slice_duration+`
`,i+="Time Axis Shift = "+this.toffset+`
`,i+="Slice Start = "+this.slice_start+`
`,i+="Slice End = "+this.slice_end+`
`,i+='Description: "'+this.description+`"
`,i+='Auxiliary File: "'+this.aux_file+`"
`,i+="Q-Form Code = "+this.qform_code+" ("+this.getTransformCodeString(this.qform_code)+`)
`,i+="S-Form Code = "+this.sform_code+" ("+this.getTransformCodeString(this.sform_code)+`)
`,i+="Quaternion Parameters:  b = "+t(this.quatern_b)+"  c = "+t(this.quatern_c)+"  d = "+t(this.quatern_d)+`
`,i+="Quaternion Offsets:  x = "+this.qoffset_x+"  y = "+this.qoffset_y+"  z = "+this.qoffset_z+`
`,i+="S-Form Parameters X: "+t(this.affine[0][0])+", "+t(this.affine[0][1])+", "+t(this.affine[0][2])+", "+t(this.affine[0][3])+`
`,i+="S-Form Parameters Y: "+t(this.affine[1][0])+", "+t(this.affine[1][1])+", "+t(this.affine[1][2])+", "+t(this.affine[1][3])+`
`,i+="S-Form Parameters Z: "+t(this.affine[2][0])+", "+t(this.affine[2][1])+", "+t(this.affine[2][2])+", "+t(this.affine[2][3])+`
`,i+="Slice Code = "+this.slice_code+`
`,i+="Units Code = "+this.xyzt_units+" ("+this.getUnitsCodeString(pt.NIFTI1.SPATIAL_UNITS_MASK&this.xyzt_units)+", "+this.getUnitsCodeString(pt.NIFTI1.TEMPORAL_UNITS_MASK&this.xyzt_units)+`)
`,i+="Intent Code = "+this.intent_code+`
`,i+='Intent Name: "'+this.intent_name+`"
`,i+="Dim Info = "+this.dim_info+`
`,i}getExtensionLocation=function(){return e.MAGIC_COOKIE+4};getExtensionSize=pt.NIFTI1.prototype.getExtensionSize;getExtensionCode=pt.NIFTI1.prototype.getExtensionCode;addExtension=pt.NIFTI1.prototype.addExtension;removeExtension=pt.NIFTI1.prototype.removeExtension;getDatatypeCodeString=pt.NIFTI1.prototype.getDatatypeCodeString;getTransformCodeString=pt.NIFTI1.prototype.getTransformCodeString;getUnitsCodeString=pt.NIFTI1.prototype.getUnitsCodeString;getQformMat=pt.NIFTI1.prototype.getQformMat;convertNiftiQFormToNiftiSForm=pt.NIFTI1.prototype.convertNiftiQFormToNiftiSForm;convertNiftiSFormToNEMA=pt.NIFTI1.prototype.convertNiftiSFormToNEMA;nifti_mat33_mul=pt.NIFTI1.prototype.nifti_mat33_mul;nifti_mat33_determ=pt.NIFTI1.prototype.nifti_mat33_determ;toArrayBuffer(t=!1){let r=544;if(t)for(let l of this.extensions)r+=l.esize;let s=new Uint8Array(r),a=new DataView(s.buffer);a.setInt32(0,540,this.littleEndian),s.set(Buffer.from(this.magic),4),a.setInt16(12,this.datatypeCode,this.littleEndian),a.setInt16(14,this.numBitsPerVoxel,this.littleEndian);for(let l=0;l<8;l++)a.setBigInt64(16+8*l,BigInt(this.dims[l]),this.littleEndian);a.setFloat64(80,this.intent_p1,this.littleEndian),a.setFloat64(88,this.intent_p2,this.littleEndian),a.setFloat64(96,this.intent_p3,this.littleEndian);for(let l=0;l<8;l++)a.setFloat64(104+8*l,this.pixDims[l],this.littleEndian);a.setBigInt64(168,BigInt(this.vox_offset),this.littleEndian),a.setFloat64(176,this.scl_slope,this.littleEndian),a.setFloat64(184,this.scl_inter,this.littleEndian),a.setFloat64(192,this.cal_max,this.littleEndian),a.setFloat64(200,this.cal_min,this.littleEndian),a.setFloat64(208,this.slice_duration,this.littleEndian),a.setFloat64(216,this.toffset,this.littleEndian),a.setBigInt64(224,BigInt(this.slice_start),this.littleEndian),a.setBigInt64(232,BigInt(this.slice_end),this.littleEndian),s.set(Buffer.from(this.description),240),s.set(Buffer.from(this.aux_file),320),a.setInt32(344,this.qform_code,this.littleEndian),a.setInt32(348,this.sform_code,this.littleEndian),a.setFloat64(352,this.quatern_b,this.littleEndian),a.setFloat64(360,this.quatern_c,this.littleEndian),a.setFloat64(368,this.quatern_d,this.littleEndian),a.setFloat64(376,this.qoffset_x,this.littleEndian),a.setFloat64(384,this.qoffset_y,this.littleEndian),a.setFloat64(392,this.qoffset_z,this.littleEndian);let o=this.affine.flat();for(let l=0;l<12;l++)a.setFloat64(400+8*l,o[l],this.littleEndian);if(a.setInt32(496,this.slice_code,this.littleEndian),a.setInt32(500,this.xyzt_units,this.littleEndian),a.setInt32(504,this.intent_code,this.littleEndian),s.set(Buffer.from(this.intent_name),508),a.setUint8(524,this.dim_info),t){s.set(Uint8Array.from([1,0,0,0]),540);let l=this.getExtensionLocation();for(let f of this.extensions)a.setInt32(l,f.esize,f.littleEndian),a.setInt32(l+4,f.ecode,f.littleEndian),s.set(new Uint8Array(f.edata),l+8),l+=f.esize}else s.set(new Uint8Array(4).fill(0),540);return s.buffer}};ri.NIFTI2=Xi});var rr=Kt($=>{"use strict";var rs=$&&$.__createBinding||(Object.create?function(e,t,i,n){n===void 0&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);(!r||("get"in r?!t.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){n===void 0&&(n=i),e[n]=t[i]}),ss=$&&$.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),as=$&&$.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var i in e)i!=="default"&&Object.prototype.hasOwnProperty.call(e,i)&&rs(t,e,i);return ss(t,e),t};Object.defineProperty($,"__esModule",{value:!0});$.readExtensionData=$.readExtension=$.readImage=$.hasExtension=$.readHeader=$.decompress=$.isCompressed=$.isNIFTI=$.isNIFTI2=$.isNIFTI1=$.NIFTIEXTENSION=$.Utils=$.NIFTI2=$.NIFTI1=void 0;var os=as(tr()),wt=ni(),Mt=Hi(),er=_e(),ls=ni();Object.defineProperty($,"NIFTI1",{enumerable:!0,get:function(){return ls.NIFTI1}});var fs=Hi();Object.defineProperty($,"NIFTI2",{enumerable:!0,get:function(){return fs.NIFTI2}});var hs=_e();Object.defineProperty($,"Utils",{enumerable:!0,get:function(){return hs.Utils}});var us=Zi();Object.defineProperty($,"NIFTIEXTENSION",{enumerable:!0,get:function(){return us.NIFTIEXTENSION}});function $i(e,t=!1){var i,n,r,s;return e.byteLength<wt.NIFTI1.STANDARD_HEADER_SIZE?!1:(i=new DataView(e),i&&(n=i.getUint8(wt.NIFTI1.MAGIC_NUMBER_LOCATION)),r=i.getUint8(wt.NIFTI1.MAGIC_NUMBER_LOCATION+1),s=i.getUint8(wt.NIFTI1.MAGIC_NUMBER_LOCATION+2),t&&n===wt.NIFTI1.MAGIC_NUMBER2[0]&&r===wt.NIFTI1.MAGIC_NUMBER2[1]&&s===wt.NIFTI1.MAGIC_NUMBER2[2]?!0:n===wt.NIFTI1.MAGIC_NUMBER[0]&&r===wt.NIFTI1.MAGIC_NUMBER[1]&&s===wt.NIFTI1.MAGIC_NUMBER[2])}$.isNIFTI1=$i;function Qi(e,t=!1){var i,n,r,s;return e.byteLength<wt.NIFTI1.STANDARD_HEADER_SIZE?!1:(i=new DataView(e),n=i.getUint8(Mt.NIFTI2.MAGIC_NUMBER_LOCATION),r=i.getUint8(Mt.NIFTI2.MAGIC_NUMBER_LOCATION+1),s=i.getUint8(Mt.NIFTI2.MAGIC_NUMBER_LOCATION+2),t&&n===Mt.NIFTI2.MAGIC_NUMBER2[0]&&r===Mt.NIFTI2.MAGIC_NUMBER2[1]&&s===Mt.NIFTI2.MAGIC_NUMBER2[2]?!0:n===Mt.NIFTI2.MAGIC_NUMBER[0]&&r===Mt.NIFTI2.MAGIC_NUMBER[1]&&s===Mt.NIFTI2.MAGIC_NUMBER[2])}$.isNIFTI2=Qi;function cs(e,t=!1){return $i(e,t)||Qi(e,t)}$.isNIFTI=cs;function ir(e){var t,i,n;return!!(e&&(t=new DataView(e),i=t.getUint8(0),n=t.getUint8(1),i===er.Utils.GUNZIP_MAGIC_COOKIE1||n===er.Utils.GUNZIP_MAGIC_COOKIE2))}$.isCompressed=ir;function nr(e){return os.decompressSync(new Uint8Array(e)).buffer}$.decompress=nr;function ds(e,t=!1){var i=null;return ir(e)&&(e=nr(e)),$i(e,t)?i=new wt.NIFTI1:Qi(e,t)&&(i=new Mt.NIFTI2),i?i.readHeader(e):console.error("That file does not appear to be NIFTI!"),i}$.readHeader=ds;function ps(e){return e.extensionFlag[0]!=0}$.hasExtension=ps;function ys(e,t){var i=e.vox_offset,n=1,r=1;e.dims[4]&&(n=e.dims[4]),e.dims[5]&&(r=e.dims[5]);var s=e.dims[1]*e.dims[2]*e.dims[3]*n*r*(e.numBitsPerVoxel/8);return t.slice(i,i+s)}$.readImage=ys;function gs(e,t){var i=e.getExtensionLocation(),n=e.extensionSize;return t.slice(i,i+n)}$.readExtension=gs;function xs(e,t){var i=e.getExtensionLocation(),n=e.extensionSize;return t.slice(i+8,i+n)}$.readExtensionData=xs});var ai;try{ai=new TextDecoder}catch{}var M,qt,x=0;var sn=[],dr=105,pr=57342,yr=57343,Ji=57337;var tn=6,Yt={},ue=11281e4,Ft=1681e4;var oi=sn,li=0,H={},it,Me,Fe=0,de=0,st,gt,rt=[],fi=[],ct,ft,ce,en={useRecords:!1,mapsAsObjects:!0},pe=!1,an=2;try{new Function("")}catch{an=1/0}var kt=class e{constructor(t){if(t&&((t.keyMap||t._keyMap)&&!t.useRecords&&(t.useRecords=!1,t.mapsAsObjects=!0),t.useRecords===!1&&t.mapsAsObjects===void 0&&(t.mapsAsObjects=!0),t.getStructures&&(t.getShared=t.getStructures),t.getShared&&!t.structures&&((t.structures=[]).uninitialized=!0),t.keyMap)){this.mapKey=new Map;for(let[i,n]of Object.entries(t.keyMap))this.mapKey.set(n,i)}Object.assign(this,t)}decodeKey(t){return this.keyMap&&this.mapKey.get(t)||t}encodeKey(t){return this.keyMap&&this.keyMap.hasOwnProperty(t)?this.keyMap[t]:t}encodeKeys(t){if(!this._keyMap)return t;let i=new Map;for(let[n,r]of Object.entries(t))i.set(this._keyMap.hasOwnProperty(n)?this._keyMap[n]:n,r);return i}decodeKeys(t){if(!this._keyMap||t.constructor.name!="Map")return t;if(!this._mapKey){this._mapKey=new Map;for(let[n,r]of Object.entries(this._keyMap))this._mapKey.set(r,n)}let i={};return t.forEach((n,r)=>i[xt(this._mapKey.has(r)?this._mapKey.get(r):r)]=n),i}mapDecode(t,i){let n=this.decode(t);if(this._keyMap)switch(n.constructor.name){case"Array":return n.map(r=>this.decodeKeys(r))}return n}decode(t,i){if(M)return hn(()=>(Ne(),this?this.decode(t,i):e.prototype.decode.call(en,t,i)));qt=i>-1?i:t.length,x=0,li=0,de=0,Me=null,oi=sn,st=null,M=t;try{ft=t.dataView||(t.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength))}catch(n){throw M=null,t instanceof Uint8Array?n:new Error("Source must be a Uint8Array or Buffer but was a "+(t&&typeof t=="object"?t.constructor.name:typeof t))}if(this instanceof e){if(H=this,ct=this.sharedValues&&(this.pack?new Array(this.maxPrivatePackedValues||16).concat(this.sharedValues):this.sharedValues),this.structures)return it=this.structures,be();(!it||it.length>0)&&(it=[])}else H=en,(!it||it.length>0)&&(it=[]),ct=null;return be()}decodeMultiple(t,i){let n,r=0;try{let s=t.length;pe=!0;let a=this?this.decode(t,s):pi.decode(t,s);if(i){if(i(a)===!1)return;for(;x<s;)if(r=x,i(be())===!1)return}else{for(n=[a];x<s;)r=x,n.push(be());return n}}catch(s){throw s.lastPosition=r,s.values=n,s}finally{pe=!1,Ne()}}};function be(){try{let e=Q();if(st){if(x>=st.postBundlePosition){let t=new Error("Unexpected bundle position");throw t.incomplete=!0,t}x=st.postBundlePosition,st=null}if(x==qt)it=null,M=null,gt&&(gt=null);else if(x>qt){let t=new Error("Unexpected end of CBOR data");throw t.incomplete=!0,t}else if(!pe)throw new Error("Data read, but end of buffer not reached");return e}catch(e){throw Ne(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer"))&&(e.incomplete=!0),e}}function Q(){let e=M[x++],t=e>>5;if(e=e&31,e>23)switch(e){case 24:e=M[x++];break;case 25:if(t==7)return vr();e=ft.getUint16(x),x+=2;break;case 26:if(t==7){let i=ft.getFloat32(x);if(H.useFloat32>2){let n=Oe[(M[x]&127)<<1|M[x+1]>>7];return x+=4,(n*i+(i>0?.5:-.5)>>0)/n}return x+=4,i}e=ft.getUint32(x),x+=4;break;case 27:if(t==7){let i=ft.getFloat64(x);return x+=8,i}if(t>1){if(ft.getUint32(x)>0)throw new Error("JavaScript does not support arrays, maps, or strings with length over 4294967295");e=ft.getUint32(x+4)}else H.int64AsNumber?(e=ft.getUint32(x)*4294967296,e+=ft.getUint32(x+4)):e=ft.getBigUint64(x);x+=8;break;case 31:switch(t){case 2:case 3:throw new Error("Indefinite length not supported for byte or text strings");case 4:let i=[],n,r=0;for(;(n=Q())!=Yt;){if(r>=ue)throw new Error(`Array length exceeds ${ue}`);i[r++]=n}return t==4?i:t==3?i.join(""):Buffer.concat(i);case 5:let s;if(H.mapsAsObjects){let a={},o=0;if(H.keyMap)for(;(s=Q())!=Yt;){if(o++>=Ft)throw new Error(`Property count exceeds ${Ft}`);a[xt(H.decodeKey(s))]=Q()}else for(;(s=Q())!=Yt;){if(o++>=Ft)throw new Error(`Property count exceeds ${Ft}`);a[xt(s)]=Q()}return a}else{ce&&(H.mapsAsObjects=!0,ce=!1);let a=new Map;if(H.keyMap){let o=0;for(;(s=Q())!=Yt;){if(o++>=Ft)throw new Error(`Map size exceeds ${Ft}`);a.set(H.decodeKey(s),Q())}}else{let o=0;for(;(s=Q())!=Yt;){if(o++>=Ft)throw new Error(`Map size exceeds ${Ft}`);a.set(s,Q())}}return a}case 7:return Yt;default:throw new Error("Invalid major type for indefinite length "+t)}default:throw new Error("Unknown token "+e)}switch(t){case 0:return e;case 1:return~e;case 2:return mr(e);case 3:if(de>=x)return Me.slice(x-Fe,(x+=e)-Fe);if(de==0&&qt<140&&e<32){let r=e<16?on(e):xr(e);if(r!=null)return r}return gr(e);case 4:if(e>=ue)throw new Error(`Array length exceeds ${ue}`);let i=new Array(e);for(let r=0;r<e;r++)i[r]=Q();return i;case 5:if(e>=Ft)throw new Error(`Map size exceeds ${ue}`);if(H.mapsAsObjects){let r={};if(H.keyMap)for(let s=0;s<e;s++)r[xt(H.decodeKey(Q()))]=Q();else for(let s=0;s<e;s++)r[xt(Q())]=Q();return r}else{ce&&(H.mapsAsObjects=!0,ce=!1);let r=new Map;if(H.keyMap)for(let s=0;s<e;s++)r.set(H.decodeKey(Q()),Q());else for(let s=0;s<e;s++)r.set(Q(),Q());return r}case 6:if(e>=Ji){let r=it[e&8191];if(r)return r.read||(r.read=hi(r)),r.read();if(e<65536){if(e==yr){let s=Ht(),a=Q(),o=Q();ci(a,o);let l={};if(H.keyMap)for(let f=2;f<s;f++){let d=H.decodeKey(o[f-2]);l[xt(d)]=Q()}else for(let f=2;f<s;f++){let d=o[f-2];l[xt(d)]=Q()}return l}else if(e==pr){let s=Ht(),a=Q();for(let o=2;o<s;o++)ci(a++,Q());return Q()}else if(e==Ji)return Sr();if(H.getShared&&(di(),r=it[e&8191],r))return r.read||(r.read=hi(r)),r.read()}}let n=rt[e];if(n)return n.handlesRead?n(Q):n(Q());{let r=Q();for(let s=0;s<fi.length;s++){let a=fi[s](e,r);if(a!==void 0)return a}return new _t(r,e)}case 7:switch(e){case 20:return!1;case 21:return!0;case 22:return null;case 23:return;case 31:default:let r=(ct||Rt())[e];if(r!==void 0)return r;throw new Error("Unknown token "+e)}default:if(isNaN(e)){let r=new Error("Unexpected end of CBOR data");throw r.incomplete=!0,r}throw new Error("Unknown CBOR token "+e)}}var nn=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function hi(e){if(!e)throw new Error("Structure is required in record definition");function t(){let i=M[x++];if(i=i&31,i>23)switch(i){case 24:i=M[x++];break;case 25:i=ft.getUint16(x),x+=2;break;case 26:i=ft.getUint32(x),x+=4;break;default:throw new Error("Expected array header, but got "+M[x-1])}let n=this.compiledReader;for(;n;){if(n.propertyCount===i)return n(Q);n=n.next}if(this.slowReads++>=an){let s=this.length==i?this:this.slice(0,i);return n=H.keyMap?new Function("r","return {"+s.map(a=>H.decodeKey(a)).map(a=>nn.test(a)?xt(a)+":r()":"["+JSON.stringify(a)+"]:r()").join(",")+"}"):new Function("r","return {"+s.map(a=>nn.test(a)?xt(a)+":r()":"["+JSON.stringify(a)+"]:r()").join(",")+"}"),this.compiledReader&&(n.next=this.compiledReader),n.propertyCount=i,this.compiledReader=n,n(Q)}let r={};if(H.keyMap)for(let s=0;s<i;s++)r[xt(H.decodeKey(this[s]))]=Q();else for(let s=0;s<i;s++)r[xt(this[s])]=Q();return r}return e.slowReads=0,t}function xt(e){if(typeof e=="string")return e==="__proto__"?"__proto_":e;if(typeof e=="number"||typeof e=="boolean"||typeof e=="bigint")return e.toString();if(e==null)return e+"";throw new Error("Invalid property name type "+typeof e)}var gr=ui;function ui(e){let t;if(e<16&&(t=on(e)))return t;if(e>64&&ai)return ai.decode(M.subarray(x,x+=e));let i=x+e,n=[];for(t="";x<i;){let r=M[x++];if((r&128)===0)n.push(r);else if((r&224)===192){let s=M[x++]&63;n.push((r&31)<<6|s)}else if((r&240)===224){let s=M[x++]&63,a=M[x++]&63;n.push((r&31)<<12|s<<6|a)}else if((r&248)===240){let s=M[x++]&63,a=M[x++]&63,o=M[x++]&63,l=(r&7)<<18|s<<12|a<<6|o;l>65535&&(l-=65536,n.push(l>>>10&1023|55296),l=56320|l&1023),n.push(l)}else n.push(r);n.length>=4096&&(t+=ot.apply(String,n),n.length=0)}return n.length>0&&(t+=ot.apply(String,n)),t}var ot=String.fromCharCode;function xr(e){let t=x,i=new Array(e);for(let n=0;n<e;n++){let r=M[x++];if((r&128)>0){x=t;return}i[n]=r}return ot.apply(String,i)}function on(e){if(e<4)if(e<2){if(e===0)return"";{let t=M[x++];if((t&128)>1){x-=1;return}return ot(t)}}else{let t=M[x++],i=M[x++];if((t&128)>0||(i&128)>0){x-=2;return}if(e<3)return ot(t,i);let n=M[x++];if((n&128)>0){x-=3;return}return ot(t,i,n)}else{let t=M[x++],i=M[x++],n=M[x++],r=M[x++];if((t&128)>0||(i&128)>0||(n&128)>0||(r&128)>0){x-=4;return}if(e<6){if(e===4)return ot(t,i,n,r);{let s=M[x++];if((s&128)>0){x-=5;return}return ot(t,i,n,r,s)}}else if(e<8){let s=M[x++],a=M[x++];if((s&128)>0||(a&128)>0){x-=6;return}if(e<7)return ot(t,i,n,r,s,a);let o=M[x++];if((o&128)>0){x-=7;return}return ot(t,i,n,r,s,a,o)}else{let s=M[x++],a=M[x++],o=M[x++],l=M[x++];if((s&128)>0||(a&128)>0||(o&128)>0||(l&128)>0){x-=8;return}if(e<10){if(e===8)return ot(t,i,n,r,s,a,o,l);{let f=M[x++];if((f&128)>0){x-=9;return}return ot(t,i,n,r,s,a,o,l,f)}}else if(e<12){let f=M[x++],d=M[x++];if((f&128)>0||(d&128)>0){x-=10;return}if(e<11)return ot(t,i,n,r,s,a,o,l,f,d);let h=M[x++];if((h&128)>0){x-=11;return}return ot(t,i,n,r,s,a,o,l,f,d,h)}else{let f=M[x++],d=M[x++],h=M[x++],v=M[x++];if((f&128)>0||(d&128)>0||(h&128)>0||(v&128)>0){x-=12;return}if(e<14){if(e===12)return ot(t,i,n,r,s,a,o,l,f,d,h,v);{let S=M[x++];if((S&128)>0){x-=13;return}return ot(t,i,n,r,s,a,o,l,f,d,h,v,S)}}else{let S=M[x++],A=M[x++];if((S&128)>0||(A&128)>0){x-=14;return}if(e<15)return ot(t,i,n,r,s,a,o,l,f,d,h,v,S,A);let U=M[x++];if((U&128)>0){x-=15;return}return ot(t,i,n,r,s,a,o,l,f,d,h,v,S,A,U)}}}}}function mr(e){return H.copyBuffers?Uint8Array.prototype.slice.call(M,x,x+=e):M.subarray(x,x+=e)}var ln=new Float32Array(1),Te=new Uint8Array(ln.buffer,0,4);function vr(){let e=M[x++],t=M[x++],i=(e&127)>>2;if(i===31)return t||e&3?NaN:e&128?-1/0:1/0;if(i===0){let n=((e&3)<<8|t)/16777216;return e&128?-n:n}return Te[3]=e&128|(i>>1)+56,Te[2]=(e&7)<<5|t>>3,Te[1]=t<<5,Te[0]=0,ln[0]}var Es=new Array(4096);var _t=class{constructor(t,i){this.value=t,this.tag=i}};rt[0]=e=>new Date(e);rt[1]=e=>new Date(Math.round(e*1e3));rt[2]=e=>{let t=BigInt(0);for(let i=0,n=e.byteLength;i<n;i++)t=BigInt(e[i])+(t<<BigInt(8));return t};rt[3]=e=>BigInt(-1)-rt[2](e);rt[4]=e=>+(e[1]+"e"+e[0]);rt[5]=e=>e[1]*Math.exp(e[0]*Math.log(2));var ci=(e,t)=>{e=e-57344;let i=it[e];i&&i.isShared&&((it.restoreStructures||(it.restoreStructures=[]))[e]=i),it[e]=t,t.read=hi(t)};rt[dr]=e=>{let t=e.length,i=e[1];ci(e[0],i);let n={};for(let r=2;r<t;r++){let s=i[r-2];n[xt(s)]=e[r]}return n};rt[14]=e=>st?st[0].slice(st.position0,st.position0+=e):new _t(e,14);rt[15]=e=>st?st[1].slice(st.position1,st.position1+=e):new _t(e,15);var Ir={Error,RegExp};rt[27]=e=>(Ir[e[0]]||Error)(e[1],e[2]);var fn=e=>{if(M[x++]!=132){let i=new Error("Packed values structure must be followed by a 4 element array");throw M.length<x&&(i.incomplete=!0),i}let t=e();if(!t||!t.length){let i=new Error("Packed values structure must be followed by a 4 element array");throw i.incomplete=!0,i}return ct=ct?t.concat(ct.slice(t.length)):t,ct.prefixes=e(),ct.suffixes=e(),e()};fn.handlesRead=!0;rt[51]=fn;rt[tn]=e=>{if(!ct)if(H.getShared)di();else return new _t(e,tn);if(typeof e=="number")return ct[16+(e>=0?2*e:-2*e-1)];let t=new Error("No support for non-integer packed references yet");throw e===void 0&&(t.incomplete=!0),t};rt[28]=e=>{gt||(gt=new Map,gt.id=0);let t=gt.id++,i=x,n=M[x],r;n>>5==4?r=[]:r={};let s={target:r};gt.set(t,s);let a=e();return s.used?(Object.getPrototypeOf(r)!==Object.getPrototypeOf(a)&&(x=i,r=a,gt.set(t,{target:r}),a=e()),Object.assign(r,a)):(s.target=a,a)};rt[28].handlesRead=!0;rt[29]=e=>{let t=gt.get(e);return t.used=!0,t.target};rt[258]=e=>new Set(e);(rt[259]=e=>(H.mapsAsObjects&&(H.mapsAsObjects=!1,ce=!0),e())).handlesRead=!0;function Xt(e,t){return typeof e=="string"?e+t:e instanceof Array?e.concat(t):Object.assign({},e,t)}function Rt(){if(!ct)if(H.getShared)di();else throw new Error("No packed values available");return ct}var Er=1399353956;fi.push((e,t)=>{if(e>=225&&e<=255)return Xt(Rt().prefixes[e-224],t);if(e>=28704&&e<=32767)return Xt(Rt().prefixes[e-28672],t);if(e>=1879052288&&e<=2147483647)return Xt(Rt().prefixes[e-1879048192],t);if(e>=216&&e<=223)return Xt(t,Rt().suffixes[e-216]);if(e>=27647&&e<=28671)return Xt(t,Rt().suffixes[e-27639]);if(e>=1811940352&&e<=1879048191)return Xt(t,Rt().suffixes[e-1811939328]);if(e==Er)return{packedValues:ct,structures:it.slice(0),version:t};if(e==55799)return t});var Ar=new Uint8Array(new Uint16Array([1]).buffer)[0]==1,rn=[Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,typeof BigUint64Array>"u"?{name:"BigUint64Array"}:BigUint64Array,Int8Array,Int16Array,Int32Array,typeof BigInt64Array>"u"?{name:"BigInt64Array"}:BigInt64Array,Float32Array,Float64Array],wr=[64,68,69,70,71,72,77,78,79,85,86];for(let e=0;e<rn.length;e++)_r(rn[e],wr[e]);function _r(e,t){let i="get"+e.name.slice(0,-5),n;typeof e=="function"?n=e.BYTES_PER_ELEMENT:e=null;for(let r=0;r<2;r++){if(!r&&n==1)continue;let s=n==2?1:n==4?2:n==8?3:0;rt[r?t:t-4]=n==1||r==Ar?a=>{if(!e)throw new Error("Could not find typed array for code "+t);return!H.copyBuffers&&(n===1||n===2&&!(a.byteOffset&1)||n===4&&!(a.byteOffset&3)||n===8&&!(a.byteOffset&7))?new e(a.buffer,a.byteOffset,a.byteLength>>s):new e(Uint8Array.prototype.slice.call(a,0).buffer)}:a=>{if(!e)throw new Error("Could not find typed array for code "+t);let o=new DataView(a.buffer,a.byteOffset,a.byteLength),l=a.length>>s,f=new e(l),d=o[i];for(let h=0;h<l;h++)f[h]=d.call(o,h<<s,r);return f}}}function Sr(){let e=Ht(),t=x+Q();for(let n=2;n<e;n++){let r=Ht();x+=r}let i=x;return x=t,st=[ui(Ht()),ui(Ht())],st.position0=0,st.position1=0,st.postBundlePosition=x,x=i,Q()}function Ht(){let e=M[x++]&31;if(e>23)switch(e){case 24:e=M[x++];break;case 25:e=ft.getUint16(x),x+=2;break;case 26:e=ft.getUint32(x),x+=4;break}return e}function di(){if(H.getShared){let e=hn(()=>(M=null,H.getShared()))||{},t=e.structures||[];H.sharedVersion=e.version,ct=H.sharedValues=e.packedValues,it===!0?H.structures=it=t:it.splice.apply(it,[0,t.length].concat(t))}}function hn(e){let t=qt,i=x,n=li,r=Fe,s=de,a=Me,o=oi,l=gt,f=st,d=new Uint8Array(M.slice(0,qt)),h=it,v=H,S=pe,A=e();return qt=t,x=i,li=n,Fe=r,de=s,Me=a,oi=o,gt=l,st=f,M=d,pe=S,it=h,H=v,ft=new DataView(M.buffer,M.byteOffset,M.byteLength),A}function Ne(){M=null,gt=null,it=null}var Oe=new Array(147);for(let e=0;e<256;e++)Oe[e]=+("1e"+Math.floor(45.15-e*.30103));var pi=new kt({useRecords:!1}),Ce=pi.decode,Ur=pi.decodeMultiple,Be={NEVER:0,ALWAYS:1,DECIMAL_ROUND:3,DECIMAL_FIT:4};var ze;try{ze=new TextEncoder}catch{}var vi,gn,Re=typeof globalThis=="object"&&globalThis.Buffer,ge=typeof Re<"u",yi=ge?Re.allocUnsafeSlow:Uint8Array,un=ge?Re:Uint8Array,cn=256,dn=ge?4294967296:2144337920;var gi,p,tt,u=0,Ct,at=null,br=61440,Tr=/[\u0080-\uFFFF]/,yt=Symbol("record-id"),ye=class extends kt{constructor(t){super(t),this.offset=0;let i,n,r,s,a,o;t=t||{};let l=un.prototype.utf8Write?function(c,I,y){return p.utf8Write(c,I,y)}:ze&&ze.encodeInto?function(c,I){return ze.encodeInto(c,p.subarray(I)).written}:!1,f=this,d=t.structures||t.saveStructures,h=t.maxSharedStructures;if(h==null&&(h=d?128:0),h>8190)throw new Error("Maximum maxSharedStructure is 8190");let v=t.sequential;v&&(h=0),this.structures||(this.structures=[]),this.saveStructures&&(this.saveShared=this.saveStructures);let S,A,U=t.sharedValues,_;if(U){_=Object.create(null);for(let c=0,I=U.length;c<I;c++)_[U[c]]=c}let b=[],B=0,N=0;this.mapEncode=function(c,I){if(this._keyMap&&!this._mapped)switch(c.constructor.name){case"Array":c=c.map(y=>this.encodeKeys(y));break}return this.encode(c,I)},this.encode=function(c,I){if(p||(p=new yi(8192),tt=new DataView(p.buffer,0,8192),u=0),Ct=p.length-10,Ct-u<2048?(p=new yi(p.length),tt=new DataView(p.buffer,0,p.length),Ct=p.length-10,u=0):I===Ei&&(u=u+7&2147483640),n=u,f.useSelfDescribedHeader&&(tt.setUint32(u,3654940416),u+=3),o=f.structuredClone?new Map:null,f.bundleStrings&&typeof c!="string"?(at=[],at.size=1/0):at=null,r=f.structures,r){if(r.uninitialized){let g=f.getShared()||{};f.structures=r=g.structures||[],f.sharedVersion=g.version;let m=f.sharedValues=g.packedValues;if(m){_={};for(let w=0,z=m.length;w<z;w++)_[m[w]]=w}}let y=r.length;if(y>h&&!v&&(y=h),!r.transitions){r.transitions=Object.create(null);for(let g=0;g<y;g++){let m=r[g];if(!m)continue;let w,z=r.transitions;for(let C=0,P=m.length;C<P;C++){z[yt]===void 0&&(z[yt]=g);let R=m[C];w=z[R],w||(w=z[R]=Object.create(null)),z=w}z[yt]=g|1048576}}v||(r.nextId=y)}if(s&&(s=!1),a=r||[],A=_,t.pack){let y=new Map;if(y.values=[],y.encoder=f,y.maxValues=t.maxPrivatePackedValues||(_?16:1/0),y.objectMap=_||!1,y.samplingPackedValues=S,De(c,y),y.values.length>0){p[u++]=216,p[u++]=51,bt(4);let g=y.values;E(g),bt(0),bt(0),A=Object.create(_||null);for(let m=0,w=g.length;m<w;m++)A[g[m]]=m}}gi=I&mi;try{if(gi)return;if(E(c),at&&yn(n,E),f.offset=u,o&&o.idsToInsert){u+=o.idsToInsert.length*2,u>Ct&&K(u),f.offset=u;let y=Nr(p.subarray(n,u),o.idsToInsert);return o=null,y}return I&Ei?(p.start=n,p.end=u,p):p.subarray(n,u)}finally{if(r){if(N<10&&N++,r.length>h&&(r.length=h),B>1e4)r.transitions=null,N=0,B=0,b.length>0&&(b=[]);else if(b.length>0&&!v){for(let y=0,g=b.length;y<g;y++)b[y][yt]=void 0;b=[]}}if(s&&f.saveShared){f.structures.length>h&&(f.structures=f.structures.slice(0,h));let y=p.subarray(n,u);return f.updateSharedData()===!1?f.encode(c):y}I&Rr&&(u=n)}},this.findCommonStringsToPack=()=>(S=new Map,_||(_=Object.create(null)),c=>{let I=c&&c.threshold||4,y=this.pack?c.maxPrivatePackedValues||16:0;U||(U=this.sharedValues=[]);for(let[g,m]of S)m.count>I&&(_[g]=y++,U.push(g),s=!0);for(;this.saveShared&&this.updateSharedData()===!1;);S=null});let E=c=>{u>Ct&&(p=K(u));var I=typeof c,y;if(I==="string"){if(A){let z=A[c];if(z>=0){z<16?p[u++]=z+224:(p[u++]=198,z&1?E(15-z>>1):E(z-16>>1));return}else if(S&&!t.pack){let C=S.get(c);C?C.count++:S.set(c,{count:1})}}let g=c.length;if(at&&g>=4&&g<1024){if((at.size+=g)>br){let C,P=(at[0]?at[0].length*3+at[1].length:0)+10;u+P>Ct&&(p=K(u+P)),p[u++]=217,p[u++]=223,p[u++]=249,p[u++]=at.position?132:130,p[u++]=26,C=u-n,u+=4,at.position&&yn(n,E),at=["",""],at.size=0,at.position=C}let z=Tr.test(c);at[z?0:1]+=c,p[u++]=z?206:207,E(g);return}let m;g<32?m=1:g<256?m=2:g<65536?m=3:m=5;let w=g*3;if(u+w>Ct&&(p=K(u+w)),g<64||!l){let z,C,P,R=u+m;for(z=0;z<g;z++)C=c.charCodeAt(z),C<128?p[R++]=C:C<2048?(p[R++]=C>>6|192,p[R++]=C&63|128):(C&64512)===55296&&((P=c.charCodeAt(z+1))&64512)===56320?(C=65536+((C&1023)<<10)+(P&1023),z++,p[R++]=C>>18|240,p[R++]=C>>12&63|128,p[R++]=C>>6&63|128,p[R++]=C&63|128):(p[R++]=C>>12|224,p[R++]=C>>6&63|128,p[R++]=C&63|128);y=R-u-m}else y=l(c,u+m,w);y<24?p[u++]=96|y:y<256?(m<2&&p.copyWithin(u+2,u+1,u+1+y),p[u++]=120,p[u++]=y):y<65536?(m<3&&p.copyWithin(u+3,u+2,u+2+y),p[u++]=121,p[u++]=y>>8,p[u++]=y&255):(m<5&&p.copyWithin(u+5,u+3,u+3+y),p[u++]=122,tt.setUint32(u,y),u+=4),u+=y}else if(I==="number")if(!this.alwaysUseFloat&&c>>>0===c)c<24?p[u++]=c:c<256?(p[u++]=24,p[u++]=c):c<65536?(p[u++]=25,p[u++]=c>>8,p[u++]=c&255):(p[u++]=26,tt.setUint32(u,c),u+=4);else if(!this.alwaysUseFloat&&c>>0===c)c>=-24?p[u++]=31-c:c>=-256?(p[u++]=56,p[u++]=~c):c>=-65536?(p[u++]=57,tt.setUint16(u,~c),u+=2):(p[u++]=58,tt.setUint32(u,~c),u+=4);else{let g;if((g=this.useFloat32)>0&&c<4294967296&&c>=-2147483648){p[u++]=250,tt.setFloat32(u,c);let m;if(g<4||(m=c*Oe[(p[u]&127)<<1|p[u+1]>>7])>>0===m){u+=4;return}else u--}p[u++]=251,tt.setFloat64(u,c),u+=8}else if(I==="object")if(!c)p[u++]=246;else{if(o){let m=o.get(c);if(m){if(p[u++]=216,p[u++]=29,p[u++]=25,!m.references){let w=o.idsToInsert||(o.idsToInsert=[]);m.references=[],w.push(m)}m.references.push(u-n),u+=2;return}else o.set(c,{offset:u-n})}let g=c.constructor;if(g===Object)X(c);else if(g===Array){y=c.length,y<24?p[u++]=128|y:bt(y);for(let m=0;m<y;m++)E(c[m])}else if(g===Map)if((this.mapsAsObjects?this.useTag259ForMaps!==!1:this.useTag259ForMaps)&&(p[u++]=217,p[u++]=1,p[u++]=3),y=c.size,y<24?p[u++]=160|y:y<256?(p[u++]=184,p[u++]=y):y<65536?(p[u++]=185,p[u++]=y>>8,p[u++]=y&255):(p[u++]=186,tt.setUint32(u,y),u+=4),f.keyMap)for(let[m,w]of c)E(f.encodeKey(m)),E(w);else for(let[m,w]of c)E(m),E(w);else{for(let m=0,w=vi.length;m<w;m++){let z=gn[m];if(c instanceof z){let C=vi[m],P=C.tag;P==null&&(P=C.getTag&&C.getTag.call(this,c)),P<24?p[u++]=192|P:P<256?(p[u++]=216,p[u++]=P):P<65536?(p[u++]=217,p[u++]=P>>8,p[u++]=P&255):P>-1&&(p[u++]=218,tt.setUint32(u,P),u+=4),C.encode.call(this,c,E,K);return}}if(c[Symbol.iterator]){if(gi){let m=new Error("Iterable should be serialized as iterator");throw m.iteratorNotHandled=!0,m}p[u++]=159;for(let m of c)E(m);p[u++]=255;return}if(c[Symbol.asyncIterator]||xi(c)){let m=new Error("Iterable/blob should be serialized as iterator");throw m.iteratorNotHandled=!0,m}if(this.useToJSON&&c.toJSON){let m=c.toJSON();if(m!==c)return E(m)}X(c)}}else if(I==="boolean")p[u++]=c?245:244;else if(I==="bigint"){if(c<BigInt(1)<<BigInt(64)&&c>=0)p[u++]=27,tt.setBigUint64(u,c);else if(c>-(BigInt(1)<<BigInt(64))&&c<0)p[u++]=59,tt.setBigUint64(u,-c-BigInt(1));else if(this.largeBigIntToFloat)p[u++]=251,tt.setFloat64(u,Number(c));else{c>=BigInt(0)?p[u++]=194:(p[u++]=195,c=BigInt(-1)-c);let g=[];for(;c;)g.push(Number(c&BigInt(255))),c>>=BigInt(8);Ii(new Uint8Array(g.reverse()),K);return}u+=8}else if(I==="undefined")p[u++]=247;else throw new Error("Unknown type: "+I)},X=this.useRecords===!1?this.variableMapSize?c=>{let I=Object.keys(c),y=Object.values(c),g=I.length;g<24?p[u++]=160|g:g<256?(p[u++]=184,p[u++]=g):g<65536?(p[u++]=185,p[u++]=g>>8,p[u++]=g&255):(p[u++]=186,tt.setUint32(u,g),u+=4);let m;if(f.keyMap)for(let w=0;w<g;w++)E(f.encodeKey(I[w])),E(y[w]);else for(let w=0;w<g;w++)E(I[w]),E(y[w])}:c=>{p[u++]=185;let I=u-n;u+=2;let y=0;if(f.keyMap)for(let g in c)(typeof c.hasOwnProperty!="function"||c.hasOwnProperty(g))&&(E(f.encodeKey(g)),E(c[g]),y++);else for(let g in c)(typeof c.hasOwnProperty!="function"||c.hasOwnProperty(g))&&(E(g),E(c[g]),y++);p[I+++n]=y>>8,p[I+n]=y&255}:(c,I)=>{let y,g=a.transitions||(a.transitions=Object.create(null)),m=0,w=0,z,C;if(this.keyMap){C=Object.keys(c).map(R=>this.encodeKey(R)),w=C.length;for(let R=0;R<w;R++){let lt=C[R];y=g[lt],y||(y=g[lt]=Object.create(null),m++),g=y}}else for(let R in c)(typeof c.hasOwnProperty!="function"||c.hasOwnProperty(R))&&(y=g[R],y||(g[yt]&1048576&&(z=g[yt]&65535),y=g[R]=Object.create(null),m++),g=y,w++);let P=g[yt];if(P!==void 0)P&=65535,p[u++]=217,p[u++]=P>>8|224,p[u++]=P&255;else if(C||(C=g.__keys__||(g.__keys__=Object.keys(c))),z===void 0?(P=a.nextId++,P||(P=0,a.nextId=1),P>=cn&&(a.nextId=(P=h)+1)):P=z,a[P]=C,P<h){p[u++]=217,p[u++]=P>>8|224,p[u++]=P&255,g=a.transitions;for(let R=0;R<w;R++)(g[yt]===void 0||g[yt]&1048576)&&(g[yt]=P),g=g[C[R]];g[yt]=P|1048576,s=!0}else{if(g[yt]=P,tt.setUint32(u,3655335680),u+=3,m&&(B+=N*m),b.length>=cn-h&&(b.shift()[yt]=void 0),b.push(g),bt(w+2),E(57344+P),E(C),I)return;for(let R in c)(typeof c.hasOwnProperty!="function"||c.hasOwnProperty(R))&&E(c[R]);return}if(w<24?p[u++]=128|w:bt(w),!I)for(let R in c)(typeof c.hasOwnProperty!="function"||c.hasOwnProperty(R))&&E(c[R])},K=c=>{let I;if(c>16777216){if(c-n>dn)throw new Error("Encoded buffer would be larger than maximum buffer size");I=Math.min(dn,Math.round(Math.max((c-n)*(c>67108864?1.25:2),4194304)/4096)*4096)}else I=(Math.max(c-n<<2,p.length-1)>>12)+1<<12;let y=new yi(I);return tt=new DataView(y.buffer,0,I),p.copy?p.copy(y,0,n,c):y.set(p.slice(n,c)),u-=n,n=0,Ct=y.length-10,p=y},q=100,O=1e3;this.encodeAsIterable=function(c,I){return V(c,I,T)},this.encodeAsAsyncIterable=function(c,I){return V(c,I,Y)};function*T(c,I,y){let g=c.constructor;if(g===Object){let m=f.useRecords!==!1;m?X(c,!0):pn(Object.keys(c).length,160);for(let w in c){let z=c[w];m||E(w),z&&typeof z=="object"?I[w]?yield*T(z,I[w]):yield*k(z,I,w):E(z)}}else if(g===Array){let m=c.length;bt(m);for(let w=0;w<m;w++){let z=c[w];z&&(typeof z=="object"||u-n>q)?I.element?yield*T(z,I.element):yield*k(z,I,"element"):E(z)}}else if(c[Symbol.iterator]&&!c.buffer){p[u++]=159;for(let m of c)m&&(typeof m=="object"||u-n>q)?I.element?yield*T(m,I.element):yield*k(m,I,"element"):E(m);p[u++]=255}else xi(c)?(pn(c.size,64),yield p.subarray(n,u),yield c,j()):c[Symbol.asyncIterator]?(p[u++]=159,yield p.subarray(n,u),yield c,j(),p[u++]=255):E(c);y&&u>n?yield p.subarray(n,u):u-n>q&&(yield p.subarray(n,u),j())}function*k(c,I,y){let g=u-n;try{E(c),u-n>q&&(yield p.subarray(n,u),j())}catch(m){if(m.iteratorNotHandled)I[y]={},u=n+g,yield*T.call(this,c,I[y]);else throw m}}function j(){q=O,f.encode(null,mi)}function V(c,I,y){return I&&I.chunkThreshold?q=O=I.chunkThreshold:q=100,c&&typeof c=="object"?(f.encode(null,mi),y(c,f.iterateProperties||(f.iterateProperties={}),!0)):[f.encode(c)]}async function*Y(c,I){for(let y of T(c,I,!0)){let g=y.constructor;if(g===un||g===Uint8Array)yield y;else if(xi(y)){let m=y.stream().getReader(),w;for(;!(w=await m.read()).done;)yield w.value}else if(y[Symbol.asyncIterator])for await(let m of y)j(),m?yield*Y(m,I.async||(I.async={})):yield f.encode(m);else yield y}}}useBuffer(t){p=t,tt=new DataView(p.buffer,p.byteOffset,p.byteLength),u=0}clearSharedData(){this.structures&&(this.structures=[]),this.sharedValues&&(this.sharedValues=void 0)}updateSharedData(){let t=this.sharedVersion||0;this.sharedVersion=t+1;let i=this.structures.slice(0),n=new Pe(i,this.sharedValues,this.sharedVersion),r=this.saveShared(n,s=>(s&&s.version||0)==t);return r===!1?(n=this.getShared()||{},this.structures=n.structures||[],this.sharedValues=n.packedValues,this.sharedVersion=n.version,this.structures.nextId=this.structures.length):i.forEach((s,a)=>this.structures[a]=s),r}};function pn(e,t){e<24?p[u++]=t|e:e<256?(p[u++]=t|24,p[u++]=e):e<65536?(p[u++]=t|25,p[u++]=e>>8,p[u++]=e&255):(p[u++]=t|26,tt.setUint32(u,e),u+=4)}var Pe=class{constructor(t,i,n){this.structures=t,this.packedValues=i,this.version=n}};function bt(e){e<24?p[u++]=128|e:e<256?(p[u++]=152,p[u++]=e):e<65536?(p[u++]=153,p[u++]=e>>8,p[u++]=e&255):(p[u++]=154,tt.setUint32(u,e),u+=4)}var Mr=typeof Blob>"u"?function(){}:Blob;function xi(e){if(e instanceof Mr)return!0;let t=e[Symbol.toStringTag];return t==="Blob"||t==="File"}function De(e,t){switch(typeof e){case"string":if(e.length>3){if(t.objectMap[e]>-1||t.values.length>=t.maxValues)return;let n=t.get(e);if(n)++n.count==2&&t.values.push(e);else if(t.set(e,{count:1}),t.samplingPackedValues){let r=t.samplingPackedValues.get(e);r?r.count++:t.samplingPackedValues.set(e,{count:1})}}break;case"object":if(e)if(e instanceof Array)for(let n=0,r=e.length;n<r;n++)De(e[n],t);else{let n=!t.encoder.useRecords;for(var i in e)e.hasOwnProperty(i)&&(n&&De(i,t),De(e[i],t))}break;case"function":console.log(e)}}var Fr=new Uint8Array(new Uint16Array([1]).buffer)[0]==1;gn=[Date,Set,Error,RegExp,_t,ArrayBuffer,Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,typeof BigUint64Array>"u"?function(){}:BigUint64Array,Int8Array,Int16Array,Int32Array,typeof BigInt64Array>"u"?function(){}:BigInt64Array,Float32Array,Float64Array,Pe];vi=[{tag:1,encode(e,t){let i=e.getTime()/1e3;(this.useTimestamp32||e.getMilliseconds()===0)&&i>=0&&i<4294967296?(p[u++]=26,tt.setUint32(u,i),u+=4):(p[u++]=251,tt.setFloat64(u,i),u+=8)}},{tag:258,encode(e,t){let i=Array.from(e);t(i)}},{tag:27,encode(e,t){t([e.name,e.message])}},{tag:27,encode(e,t){t(["RegExp",e.source,e.flags])}},{getTag(e){return e.tag},encode(e,t){t(e.value)}},{encode(e,t,i){Ii(e,i)}},{getTag(e){if(e.constructor===Uint8Array&&(this.tagUint8Array||ge&&this.tagUint8Array!==!1))return 64},encode(e,t,i){Ii(e,i)}},Ut(68,1),Ut(69,2),Ut(70,4),Ut(71,8),Ut(72,1),Ut(77,2),Ut(78,4),Ut(79,8),Ut(85,4),Ut(86,8),{encode(e,t){let i=e.packedValues||[],n=e.structures||[];if(i.values.length>0){p[u++]=216,p[u++]=51,bt(4);let r=i.values;t(r),bt(0),bt(0),packedObjectMap=Object.create(sharedPackedObjectMap||null);for(let s=0,a=r.length;s<a;s++)packedObjectMap[r[s]]=s}if(n){tt.setUint32(u,3655335424),u+=3;let r=n.slice(0);r.unshift(57344),r.push(new _t(e.version,1399353956)),t(r)}else t(new _t(e.version,1399353956))}}];function Ut(e,t){return!Fr&&t>1&&(e-=4),{tag:e,encode:function(n,r){let s=n.byteLength,a=n.byteOffset||0,o=n.buffer||n;r(ge?Re.from(o,a,s):new Uint8Array(o,a,s))}}}function Ii(e,t){let i=e.byteLength;i<24?p[u++]=64+i:i<256?(p[u++]=88,p[u++]=i):i<65536?(p[u++]=89,p[u++]=i>>8,p[u++]=i&255):(p[u++]=90,tt.setUint32(u,i),u+=4),u+i>=p.length&&t(u+i),p.set(e.buffer?e:new Uint8Array(e),u),u+=i}function Nr(e,t){let i,n=t.length*2,r=e.length-n;t.sort((s,a)=>s.offset>a.offset?1:-1);for(let s=0;s<t.length;s++){let a=t[s];a.id=s;for(let o of a.references)e[o++]=s>>8,e[o]=s&255}for(;i=t.pop();){let s=i.offset;e.copyWithin(s+n,s,r),n-=2;let a=s+n;e[a++]=216,e[a++]=28,r=s}return e}function yn(e,t){tt.setUint32(at.position+e,u-at.position-e+1);let i=at;at=null,t(i[0]),t(i[1])}var Ai=new ye({useRecords:!1}),qe=Ai.encode,Or=Ai.encodeAsIterable,Cr=Ai.encodeAsAsyncIterable,{NEVER:Br,ALWAYS:zr,DECIMAL_ROUND:Dr,DECIMAL_FIT:Pr}=Be,Ei=512,Rr=1024,mi=2048;var sr=cr(rr(),1);function ms(e){if(!Object.prototype.hasOwnProperty.call(e,"meshType")||!Object.prototype.hasOwnProperty.call(e,"cells")||!Object.prototype.hasOwnProperty.call(e,"points"))throw new Error('.iwm.cbor must have "meshType", "cells" and "points".');let t;if(e.cells instanceof BigUint64Array||e.cells instanceof BigInt64Array){t=new Uint32Array(e.cells.length);for(let o=0;o<e.cells.length;o++)t[o]=Number(BigInt(e.cells[o])&BigInt(4294967295))}else if(e.cells[0]instanceof Uint32Array||typeof e.cells[0]=="number")t=new Uint32Array(e.cells);else throw new Error("Unsupported data type in iwm.cells");let i=0,n=0;for(;n<t.length;){let o=t[n],l=t[n+1];if(o<2||o<2||l<3)throw new Error(`unsupported iwm cell type ${o} or cellNum ${l}`);n+=l+2,i+=l-2}let r=new Uint32Array(i*3);n=0;let s=0;for(;n<t.length;){let o=t[n+1],l=o-2;for(let f=0;f<l;f++)r[s++]=t[n+2],r[s++]=t[n+2+1+f],r[s++]=t[n+2+2+f];n+=o+2}let a=new Float32Array(e.points);for(n=0;n<a.length;)a[n]=-a[n],a[n+1]=-a[n+1],n+=3;return{positions:a,indices:r}}function Hs(e){let t=Ce(new Uint8Array(e));return ms(t)}function $s(e,t,i=!0){let n={meshType:{dimension:3,pointComponentType:"float32",pointPixelComponentType:"int8",pointPixelType:"Scalar",pointPixelComponents:0,cellComponentType:"uint64",cellPixelComponentType:"int8",cellPixelType:"Scalar",cellPixelComponents:0},numberOfPointPixels:0n,numberOfCellPixels:0n},r=Math.floor(t.length/3),s=r*5;n.cells=new BigUint64Array(s);let a=0,o=0;for(let f=0;f<r;f++)n.cells[a++]=2n,n.cells[a++]=3n,n.cells[a++]=BigInt(t[o++]),n.cells[a++]=BigInt(t[o++]),n.cells[a++]=BigInt(t[o++]);n.cellBufferSize=BigInt(s),n.numberOfCells=BigInt(r),n.points=e.slice();let l=0;for(;l<n.points.length;)n.points[l]=-n.points[l],n.points[l+1]=-n.points[l+1],l+=3;return n.numberOfPoints=BigInt(Math.floor(e.length)/3),i?qe(n):n}function vs(e){if(!Object.prototype.hasOwnProperty.call(e,"imageType")||!Object.prototype.hasOwnProperty.call(e,"size")||!Object.prototype.hasOwnProperty.call(e,"data"))throw new Error('.iwi.cbor must have "imageType", "size" and "data".');let t=new sr.NIFTI1;t.littleEndian=!0,t.dims=[3,1,1,1,0,0,0,0],t.dims[0]=e.size.length;let i=1;for(let o=0;o<e.size.length;o++)t.dims[o+1]=Number(BigInt(e.size[o])&BigInt(4294967295)),i*=Math.max(t.dims[o+1],1);if(t.pixDims=[1,1,1,1,1,0,0,0],Object.prototype.hasOwnProperty.call(e,"spacing"))for(let o=0;o<e.spacing.length;o++)t.pixDims[o+1]=e.spacing[o];if(e.data instanceof Uint8Array)Object.prototype.hasOwnProperty.call(e.imageType,"pixelType")&&e.imageType.pixelType==="RGB"?(t.numBitsPerVoxel=24,t.datatypeCode=128):(t.numBitsPerVoxel=8,t.datatypeCode=2);else if(e.data instanceof Int16Array)t.numBitsPerVoxel=16,t.datatypeCode=4;else if(e.data instanceof Uint16Array)t.numBitsPerVoxel=16,t.datatypeCode=512;else if(e.data instanceof Int32Array)t.numBitsPerVoxel=32,t.datatypeCode=8;else if(e.data instanceof Float64Array)t.numBitsPerVoxel=64,t.datatypeCode=64;else if(e.data instanceof Float32Array)t.numBitsPerVoxel=32,t.datatypeCode=16;else throw new Error(".iwi.cbor voxels use unsupported datatype.");let n=i*Math.floor(t.numBitsPerVoxel/8),r=new Uint8Array(e.data.buffer,e.data.byteOffset,e.data.byteLength);if(n!==r.byteLength)throw new Error(`expected ${n} bytes but have ${r.byteLength}`);if(t.vox_offset=352,t.scl_inter=0,t.scl_slope=1,t.magic="n+1",Object.prototype.hasOwnProperty.call(e,"direction")&&Object.prototype.hasOwnProperty.call(e,"origin")){let o=e.direction.slice(),l=e.spacing.slice(),f=e.origin;t.sform_code=1,t.affine=[[o[0]*-l[0],o[3]*-l[1],o[6]*-l[2],-f[0]],[o[1]*-l[0],o[4]*-l[1],o[7]*-l[2],-f[1]],[o[2]*l[0],o[5]*l[1],o[8]*l[2],f[2]],[0,0,0,1]]}let s=t.toArrayBuffer(),a=new Uint8Array(s.byteLength+r.byteLength);return a.set(new Uint8Array(s),0),a.set(r,s.byteLength),a}function Qs(e){let t=Ce(new Uint8Array(e));return vs(t)}function Ws(e,t,i=!1){let n={imageType:{dimension:e.dims[0],componentType:"uint8",pixelType:"Scalar",components:1},direction:new Float64Array(9),origin:[],size:[],spacing:[],metadata:[]};for(let r=0;r<e.dims[0];r++)n.spacing[r]=e.pixDims[r+1],n.size[r]=e.dims[r+1];if(e.dims[0]>2){n.origin[0]=-e.affine[0][3],n.origin[1]=-e.affine[1][3],n.origin[2]=e.affine[2][3];let r=[e.pixDims[1],e.pixDims[2],e.pixDims[3]];n.direction[0]=e.affine[0][0]/-r[0],n.direction[1]=e.affine[1][0]/-r[0],n.direction[2]=e.affine[2][0]/r[0],n.direction[3]=e.affine[0][1]/-r[1],n.direction[4]=e.affine[1][1]/-r[1],n.direction[5]=e.affine[2][1]/r[1],n.direction[6]=e.affine[0][2]/-r[2],n.direction[7]=e.affine[1][2]/-r[2],n.direction[8]=e.affine[2][2]/r[2]}if(e.datatypeCode===128)n.imageType.pixelType="RGB",n.imageType.componentType="uint8",n.imageType.components=3,n.data=new Uint8Array(t);else if(e.datatypeCode===64)n.imageType.componentType="float64",n.data=new Float64Array(t);else if(e.datatypeCode===16)n.imageType.componentType="float32",n.data=new Float32Array(t);else if(e.datatypeCode===2)n.imageType.componentType="uint8",n.data=new Uint8Array(t);else if(e.datatypeCode===4)n.imageType.componentType="int16",n.data=new Int16Array(t);else if(e.datatypeCode===8)n.imageType.componentType="int32",n.data=new Int32Array(t);else throw new Error(`NIfTI voxels use unsupported datatype ${e.datatypeCode}.`);return n.size=n.size.map(r=>BigInt(r)),i?qe(n):n}export{Qs as iwi2nii,vs as iwi2niiCore,Hs as iwm2mesh,ms as iwm2meshCore,$s as mesh2iwm,Ws as nii2iwi};
